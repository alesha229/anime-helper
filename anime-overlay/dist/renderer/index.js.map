{
  "version": 3,
  "sources": ["../../src/renderer/index.ts"],
  "sourcesContent": ["// \u0413\u043B\u043E\u0431\u0430\u043B\u044C\u043D\u044B\u0435 \u043E\u0431\u044A\u044F\u0432\u043B\u0435\u043D\u0438\u044F \u0434\u043B\u044F TS (\u043C\u0438\u043D\u0438\u043C\u0430\u043B\u044C\u043D\u043E, \u0431\u0435\u0437 global augmentation)\ndeclare const PIXI: any;\n\n// \u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0447\u0435\u0440\u0435\u0437 CDN, \u043C\u043E\u0436\u043D\u043E \u0437\u0430\u043C\u0435\u043D\u0438\u0442\u044C \u043D\u0430 \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u044B\u0435 \u0430\u0441\u0441\u0435\u0442\u044B\n(async function () {\n  function loadScript(src) {\n    return new Promise((res, rej) => {\n      const s = document.createElement(\"script\");\n      s.src = src;\n      s.onload = () => res(src);\n      s.onerror = (ev) =>\n        rej(\n          new Error(\n            \"Failed to load script \" +\n              src +\n              \" (\" +\n              (ev && ev.message ? ev.message : ev) +\n              \")\"\n          )\n        );\n      document.head.appendChild(s);\n    });\n  }\n  try {\n    // PIXI \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043D \u0432\u044B\u0448\u0435; Cubism Core \u0438 \u043F\u043B\u0430\u0433\u0438\u043D\u044B \u043F\u043E\u0434\u043A\u043B\u044E\u0447\u0430\u0435\u043C \u043B\u0435\u043D\u0438\u0432\u043E\n    const app = new PIXI.Application({\n      transparent: true,\n      width: 320,\n      height: 480,\n    });\n    document.getElementById(\"model\").appendChild(app.view);\n    try {\n      (app.stage as any).interactive = true;\n    } catch {}\n    const modelContainerEl = document.getElementById(\"model\");\n\n    // --- Dragging support for the Live2D model ---\n    const dragState: any = {\n      active: false,\n      data: null,\n      startX: 0,\n      startY: 0,\n      origX: 0,\n      origY: 0,\n      target: null,\n    };\n\n    function installStageDragHandlers() {\n      try {\n        if ((app.stage as any).__dragHandlersInstalled) return;\n        (app.stage as any).interactive = true;\n        const onMove = (ev: any) => {\n          try {\n            if (!dragState.active || !dragState.data || !dragState.target)\n              return;\n            const parent = dragState.target.parent || app.stage;\n            const p = dragState.data.getLocalPosition(parent);\n            const nx = dragState.origX + (p.x - dragState.startX);\n            const ny = dragState.origY + (p.y - dragState.startY);\n            dragState.target.position.set(nx, ny);\n          } catch {}\n        };\n        const onUp = () => {\n          try {\n            if (dragState.target) {\n              try {\n                (dragState.target as any).__userMoved = true;\n              } catch {}\n              try {\n                (dragState.target as any).cursor = \"grab\";\n              } catch {}\n            }\n            dragState.active = false;\n            dragState.data = null;\n            dragState.target = null;\n          } catch {}\n        };\n        app.stage.on(\"pointermove\", onMove);\n        app.stage.on(\"pointerup\", onUp);\n        app.stage.on(\"pointerupoutside\", onUp);\n        app.stage.on(\"pointercancel\", onUp as any);\n        (app.stage as any).__dragHandlersInstalled = true;\n      } catch {}\n    }\n\n    function enableDraggingForModel(target: any) {\n      if (!target) return;\n      installStageDragHandlers();\n      try {\n        target.interactive = true;\n        (target as any).cursor = \"grab\";\n      } catch {}\n      const onDown = (event: any) => {\n        try {\n          dragState.active = true;\n          dragState.data = event.data || event;\n          dragState.target = target;\n          const parent = target.parent || app.stage;\n          const p = dragState.data.getLocalPosition(parent);\n          dragState.startX = p.x;\n          dragState.startY = p.y;\n          dragState.origX = target.x;\n          dragState.origY = target.y;\n          try {\n            (target as any).cursor = \"grabbing\";\n          } catch {}\n          if (event.stopPropagation) event.stopPropagation();\n        } catch {}\n      };\n      target.on(\"pointerdown\", onDown);\n      target.on(\"touchstart\", onDown);\n    }\n\n    function fitModelToCanvas() {\n      if (!model) return;\n      try {\n        if (model.anchor && typeof model.anchor.set === \"function\") {\n          model.anchor.set(0.5, 0.5);\n        }\n      } catch {}\n      try {\n        const userMoved = !!(model as any).__userMoved;\n        if (!userMoved) {\n          model.x = app.renderer.width / 2;\n          model.y = app.renderer.height / 2;\n        }\n        const b = model.getBounds();\n        const bw = Math.max(1, b.width);\n        const bh = Math.max(1, b.height);\n        // Enlarge a bit to compensate invisible margins in many models\n        const fudge = 1.2; // 20% larger than strict fit\n        const base = Math.min(\n          (app.renderer.width * 0.98) / bw,\n          (app.renderer.height * 0.98) / bh\n        );\n        const baseScale = Math.max(0.1, Math.min(base * fudge, base * 1.4));\n        (window as any).__live2d_base_scale = baseScale;\n        let factor = 1;\n        try {\n          const input = document.getElementById(\n            \"opacity\"\n          ) as HTMLInputElement | null;\n          if (input)\n            factor = Math.max(0.5, Math.min(1.5, Number(input.value) || 1));\n        } catch {}\n        if (isFinite(baseScale) && baseScale > 0)\n          model.scale.set(baseScale * factor);\n      } catch {}\n    }\n\n    function resizeStageToContainer() {\n      try {\n        const w = (modelContainerEl && modelContainerEl.clientWidth) || 320;\n        const h = (modelContainerEl && modelContainerEl.clientHeight) || 480;\n        app.renderer.resize(w, h);\n        fitModelToCanvas();\n      } catch {}\n    }\n\n    window.addEventListener(\"resize\", resizeStageToContainer);\n    try {\n      const ro = new ResizeObserver(() => resizeStageToContainer());\n      ro.observe(modelContainerEl);\n    } catch {}\n    // initial fit\n    resizeStageToContainer();\n\n    // \u0421\u043F\u0438\u0441\u043E\u043A \u043C\u043E\u0434\u0435\u043B\u0435\u0439 \u0438\u0437 \u0440\u0435\u043F\u043E\u0437\u0438\u0442\u043E\u0440\u0438\u044F Eikanya (\u0447\u0435\u0440\u0435\u0437 jsdelivr)\n    const MODELS = [\n      // \u041F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C Cubism2 (.model.json), \u0447\u0442\u043E\u0431\u044B \u043D\u0435 \u0438\u043D\u0438\u0446\u0438\u0430\u043B\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C Cubism4 \u043D\u0430 \u0441\u0442\u0430\u0440\u0442\u0435\n      \"https://raw.githubusercontent.com/Eikanya/Live2d-model/master/%E5%B4%A9%E5%9D%8F%E5%AD%A6%E5%9B%AD2/houraiji/model.json\",\n      \"https://raw.githubusercontent.com/Eikanya/Live2d-model/master/%E7%A2%A7%E8%93%9D%E8%88%AA%E7%BA%BF%20Azue%20Lane/Azue%20Lane(JP)/abeikelongbi_3/abeikelongbi_3.model3.json\",\n      \"https://cdn.jsdelivr.net/gh/Eikanya/Live2d-model/Live2D/haru/haru_greeter_t03.model3.json\",\n    ];\n    const LAST_MODEL_KEY = \"anime_overlay_last_model_url\";\n\n    async function preloadMotionsFromModelJson(modelJsonUrl) {\n      try {\n        const resp = await fetch(modelJsonUrl);\n        if (!resp.ok) throw new Error(\"HTTP \" + resp.status);\n        const json = await resp.json();\n        const base = modelJsonUrl.replace(/[^/]+$/, \"\");\n        const motions = json.motions || {};\n        const groups = Object.keys(motions);\n        const files = [];\n        for (const g of groups) {\n          const arr = motions[g] || [];\n          for (const item of arr) {\n            if (item && item.file) files.push(base + item.file);\n          }\n        }\n        for (const f of files) {\n          try {\n            await fetch(f);\n          } catch (e) {}\n        }\n        return groups;\n      } catch (e) {\n        console.warn(\"preloadMotionsFromModelJson failed\", e);\n        return [];\n      }\n    }\n\n    async function tryLoadModel(url) {\n      try {\n        const resp = await fetch(url, { method: \"GET\" });\n        if (!resp.ok)\n          throw new Error(\n            \"HTTP \" + resp.status + \" \" + resp.statusText + \" for \" + url\n          );\n        let discoveredMotionGroups = [];\n        try {\n          discoveredMotionGroups = await preloadMotionsFromModelJson(url);\n        } catch (e) {\n          console.warn(e);\n        }\n        const model = await PIXI.live2d.Live2DModel.from(url);\n        try {\n          model.__motionGroups = discoveredMotionGroups;\n        } catch (e) {}\n        return model;\n      } catch (err) {\n        throw new Error(\n          \"Failed to load model from \" +\n            url +\n            \" \u2014 \" +\n            (err && err.message ? err.message : err)\n        );\n      }\n    }\n\n    function makeAbsolute(baseUrl, relative) {\n      try {\n        if (!relative) return relative;\n        if (/^https?:\\/\\//i.test(relative)) return relative;\n        const u = new URL(baseUrl);\n        const base = baseUrl.replace(/[^/]+$/, \"\");\n        return new URL(relative, base).toString();\n      } catch {\n        return relative;\n      }\n    }\n\n    function buildCubism2DataJson(json, baseUrl) {\n      const clone = { ...json };\n      try {\n        if (clone.model) clone.model = makeAbsolute(baseUrl, clone.model);\n        if (Array.isArray(clone.textures))\n          clone.textures = clone.textures.map((t) => makeAbsolute(baseUrl, t));\n        if (clone.physics) clone.physics = makeAbsolute(baseUrl, clone.physics);\n        if (clone.pose) clone.pose = makeAbsolute(baseUrl, clone.pose);\n        if (Array.isArray(clone.expressions)) {\n          clone.expressions = clone.expressions.map((e) => {\n            if (typeof e === \"string\") return makeAbsolute(baseUrl, e);\n            const ee = { ...e };\n            if (ee.file) ee.file = makeAbsolute(baseUrl, ee.file);\n            if (ee.File) ee.File = makeAbsolute(baseUrl, ee.File);\n            return ee;\n          });\n        }\n        if (clone.motions || clone.Motions) {\n          const motions = clone.motions || clone.Motions;\n          const out = {};\n          for (const g of Object.keys(motions || {})) {\n            out[g] = (motions[g] || []).map((m) => {\n              if (typeof m === \"string\") return makeAbsolute(baseUrl, m);\n              const mm = { ...m };\n              if (mm.file) mm.file = makeAbsolute(baseUrl, mm.file);\n              if (mm.File) mm.File = makeAbsolute(baseUrl, mm.File);\n              return mm;\n            });\n          }\n          if (clone.motions) clone.motions = out;\n          if (clone.Motions) clone.Motions = out;\n        }\n      } catch {}\n      const data =\n        \"data:application/json;charset=utf-8,\" +\n        encodeURIComponent(JSON.stringify(clone));\n      return data;\n    }\n\n    // --- Viewer-like helpers for robust model loading ---\n    function detectUseV4FromUrl(u: string | null): boolean | null {\n      try {\n        if (!u) return null;\n        const low = u.toLowerCase();\n        if (/(^|\\/)model3\\.json(\\?|$)/.test(low)) return true;\n        if (/(^|\\/)model\\.json(\\?|$)/.test(low)) return false;\n      } catch {}\n      return null;\n    }\n    function detectRuntimeByUrl(u: string | null): boolean | null {\n      try {\n        if (!u) return null;\n        const low = u.toLowerCase();\n        if (/\\.model3\\.json(\\?|$)/.test(low) || /\\.moc3(\\?|$)/.test(low))\n          return true; // C4\n        if (/\\.model\\.json(\\?|$)/.test(low) || /\\.moc(\\?|$)/.test(low))\n          return false; // C2\n        if (/\\.json(\\?|$)/.test(low)) return false; // default .json \u2192 C2\n      } catch {}\n      return null;\n    }\n    function toAbsoluteAssetUrl(modelJsonUrl: string, assetPath: string) {\n      if (!assetPath) return assetPath;\n      if (/^https?:/i.test(assetPath) || assetPath.startsWith(\"data:\"))\n        return assetPath;\n      try {\n        const base = modelJsonUrl.replace(/\\/[^/]*$/, \"/\");\n        return new URL(assetPath, base).href;\n      } catch {\n        return assetPath;\n      }\n    }\n    function rewriteModelJsonUrls(modelJsonUrl: string, j: any) {\n      try {\n        if (j && j.FileReferences) {\n          if (j.FileReferences.Moc)\n            j.FileReferences.Moc = toAbsoluteAssetUrl(\n              modelJsonUrl,\n              j.FileReferences.Moc\n            );\n          if (Array.isArray(j.FileReferences.Textures))\n            j.FileReferences.Textures = j.FileReferences.Textures.map(\n              (t: any) => toAbsoluteAssetUrl(modelJsonUrl, t)\n            );\n          if (j.FileReferences.Physics)\n            j.FileReferences.Physics = toAbsoluteAssetUrl(\n              modelJsonUrl,\n              j.FileReferences.Physics\n            );\n          if (j.FileReferences.Motions) {\n            for (const g of Object.keys(j.FileReferences.Motions)) {\n              const arr = j.FileReferences.Motions[g] || [];\n              for (const m of arr)\n                if (m.File) m.File = toAbsoluteAssetUrl(modelJsonUrl, m.File);\n            }\n          }\n        }\n        if (j) {\n          if (j.model) j.model = toAbsoluteAssetUrl(modelJsonUrl, j.model);\n          if (Array.isArray(j.textures))\n            j.textures = j.textures.map((t: any) =>\n              toAbsoluteAssetUrl(modelJsonUrl, t)\n            );\n          if (j.physics)\n            j.physics = toAbsoluteAssetUrl(modelJsonUrl, j.physics);\n          if (j.motions) {\n            for (const g of Object.keys(j.motions)) {\n              const arr = j.motions[g] || [];\n              for (let i = 0; i < arr.length; i++) {\n                const m = arr[i];\n                if (typeof m === \"string\")\n                  arr[i] = { file: toAbsoluteAssetUrl(modelJsonUrl, m) };\n                else {\n                  if ((m as any).file)\n                    (m as any).file = toAbsoluteAssetUrl(\n                      modelJsonUrl,\n                      (m as any).file\n                    );\n                  if ((m as any).File)\n                    (m as any).File = toAbsoluteAssetUrl(\n                      modelJsonUrl,\n                      (m as any).File\n                    );\n                }\n              }\n            }\n          }\n        }\n      } catch {}\n      return j;\n    }\n    async function loadSettingsJson(\n      url: string,\n      forceV4?: boolean | null\n    ): Promise<{\n      urlOrSettings: any;\n      useV4: boolean | null;\n      originalUrl: string;\n      groups: string[];\n    }> {\n      let useV4 = forceV4 ?? detectUseV4FromUrl(url);\n      const byExt = detectRuntimeByUrl(url);\n      let groups: string[] = [];\n      try {\n        const r = await fetch(url, { headers: { Accept: \"application/json\" } });\n        const txt = await r.text();\n        const j = JSON.parse(txt);\n        const cloned = JSON.parse(JSON.stringify(j));\n        rewriteModelJsonUrls(url, cloned);\n        let isC4 = false;\n        try {\n          groups = Object.keys(\n            j.motions || j.Motions || j.FileReferences?.Motions || {}\n          );\n        } catch {}\n        if (\n          j?.FileReferences?.Moc &&\n          /\\.moc3$/i.test(String(j.FileReferences.Moc))\n        )\n          isC4 = true;\n        if (\n          j?.FileReferences?.Moc &&\n          /\\.moc$/i.test(String(j.FileReferences.Moc))\n        )\n          isC4 = false;\n        if ((j.model || j.textures || j.motions) && !j.FileReferences)\n          isC4 = false;\n        if (forceV4 === true) isC4 = true;\n        if (forceV4 === false) isC4 = false;\n        if (forceV4 == null) {\n          if (byExt === true) isC4 = true;\n          if (byExt === false) isC4 = false;\n        }\n        if (isC4) {\n          useV4 = true;\n          try {\n            (cloned as any).url = url;\n          } catch {}\n          return { urlOrSettings: cloned, useV4, originalUrl: url, groups };\n        }\n        useV4 = false;\n        return { urlOrSettings: url, useV4, originalUrl: url, groups };\n      } catch {\n        return { urlOrSettings: url, useV4, originalUrl: url, groups };\n      }\n    }\n    function clearPixiCaches() {\n      try {\n        const tex = (PIXI.utils && (PIXI.utils as any).TextureCache) || {};\n        for (const k of Object.keys(tex)) {\n          try {\n            tex[k]?.destroy?.(true);\n          } catch {}\n          delete tex[k];\n        }\n      } catch {}\n      try {\n        const btex = (PIXI.utils && (PIXI.utils as any).BaseTextureCache) || {};\n        for (const k of Object.keys(btex)) {\n          try {\n            btex[k]?.destroy?.();\n          } catch {}\n          delete btex[k];\n        }\n      } catch {}\n    }\n    async function loadModel(\n      appRef: any,\n      url: string,\n      forceV4?: boolean | null\n    ) {\n      try {\n        await clearPixiCaches();\n        if ((window as any).__live2d_model) {\n          try {\n            appRef.stage.removeChild((window as any).__live2d_model);\n            (window as any).__live2d_model.destroy?.(true);\n          } catch {}\n        }\n        (window as any).__live2d_model = undefined;\n      } catch {}\n      const { urlOrSettings, useV4, originalUrl, groups } =\n        await loadSettingsJson(url, forceV4);\n      try {\n        const desired: \"c2\" | \"c4\" | null =\n          useV4 === true ? \"c4\" : useV4 === false ? \"c2\" : null;\n        if (\n          desired &&\n          (window as any).__loadedRuntime &&\n          (window as any).__loadedRuntime !== desired\n        ) {\n          (\n            window.location as any\n          ).href = `index.html?model=${encodeURIComponent(originalUrl)}`;\n          throw new Error(\"Switching runtime requires reload\");\n        }\n      } catch {}\n      if (useV4 === true) await ensureCubism4();\n      else if (useV4 === false) await ensureCubism2();\n      else await ensureCubism4();\n\n      let loadedModel: any = null;\n      const ns = useV4\n        ? (window as any).__live2d_api_c4 || (PIXI as any).live2d\n        : (window as any).__live2d_api_c2 || (PIXI as any).live2d;\n      const prevLive2d = (PIXI as any).live2d;\n      (PIXI as any).live2d = ns;\n      try {\n        loadedModel = await (PIXI as any).live2d.Live2DModel.from(\n          urlOrSettings,\n          {\n            motionPreload: \"none\",\n          }\n        );\n      } catch {\n        try {\n          loadedModel = await (PIXI as any).live2d.Live2DModel.from(\n            urlOrSettings\n          );\n        } catch {\n          if (useV4 === false && typeof urlOrSettings === \"string\") {\n            try {\n              const resp = await fetch(String(urlOrSettings), {\n                headers: { Accept: \"application/json\" },\n              });\n              const txt = await resp.text();\n              const j = JSON.parse(txt);\n              const cloned = JSON.parse(JSON.stringify(j));\n              rewriteModelJsonUrls(String(urlOrSettings), cloned);\n              loadedModel = await (PIXI as any).live2d.Live2DModel.from(cloned);\n            } catch {}\n          }\n        }\n      } finally {\n        try {\n          (PIXI as any).live2d = prevLive2d;\n        } catch {}\n      }\n      try {\n        if (loadedModel && loadedModel.anchor && loadedModel.anchor.set)\n          loadedModel.anchor.set(0.5, 0.5);\n      } catch {}\n      appRef.stage.addChild(loadedModel);\n      try {\n        enableDraggingForModel(loadedModel);\n      } catch {}\n      try {\n        (window as any).__live2d_model = loadedModel;\n      } catch {}\n      return { model: loadedModel, groups, fitModel: fitModelToCanvas };\n    }\n\n    function urlToRepoPath(url) {\n      try {\n        const u = new URL(url);\n        if (u.hostname === \"raw.githubusercontent.com\") {\n          // /Eikanya/Live2d-model/<ref>/<path>\n          const parts = u.pathname.split(\"/\").filter(Boolean);\n          return decodeURIComponent(parts.slice(3).join(\"/\"));\n        }\n        if (u.hostname === \"cdn.jsdelivr.net\") {\n          // /gh/Eikanya/Live2d-model@<ref>/<path>\n          const m = u.pathname.match(\n            /\\/gh\\/Eikanya\\/Live2d-model@[^/]+\\/(.*)$/\n          );\n          if (m) return decodeURIComponent(m[1]);\n        }\n      } catch {}\n      return null;\n    }\n\n    async function tryFindAlternateModelJsonUrl(originalUrl) {\n      const baseDir = originalUrl.replace(/[^/]+$/, \"\");\n      const tryCandidates = async (names) => {\n        for (const name of names) {\n          const cand = baseDir + name;\n          try {\n            const r = await fetch(cand, { method: \"HEAD\" });\n            if (r.ok) return cand;\n          } catch {}\n        }\n        return null;\n      };\n      // Simple filename heuristics\n      const simple = await tryCandidates([\"model.json\", \"model.model.json\"]);\n      if (simple) return simple;\n      // Use prebuilt index to list directory files\n      try {\n        await ensureIndexLoaded();\n        const repoPath = urlToRepoPath(originalUrl);\n        if (!repoPath) return null;\n        const dir = repoPath.replace(/\\/?[^/]*$/, \"\");\n        const node = findIndexNode(dir);\n        const files = (node && node.files) || [];\n        // Prefer model.json-like names, exclude model3.json\n        const sorted = files\n          .filter((f) => /\\.json$/i.test(f) && !/model3\\.json$/i.test(f))\n          .sort((a, b) => (a.toLowerCase() === \"model.json\" ? -1 : 1));\n        for (const f of sorted) {\n          const url = await resolveModelUrl((dir ? dir + \"/\" : \"\") + f);\n          try {\n            const r = await fetch(url, { method: \"HEAD\" });\n            if (r.ok) return url;\n          } catch {}\n        }\n      } catch {}\n      return null;\n    }\n\n    // select \u043C\u043E\u0434\u0435\u043B\u0438\n    const controls = document.getElementById(\"controls\");\n    const select = document.createElement(\"select\");\n    select.style.webkitAppRegion = \"no-drag\";\n    MODELS.forEach((url, i) => {\n      const opt = document.createElement(\"option\");\n      opt.value = url;\n      opt.textContent = `Model ${i + 1}`;\n      select.appendChild(opt);\n    });\n    controls.insertBefore(select, controls.firstChild);\n\n    // Add inspector open button\n    const openInspectorBtn = document.createElement(\"button\");\n    openInspectorBtn.textContent = \"Change model\uD83D\uDC96\";\n    openInspectorBtn.style.webkitAppRegion = \"no-drag\";\n    openInspectorBtn.className = \"btn\";\n    openInspectorBtn.addEventListener(\"click\", () => {\n      const current = select.value || \"\";\n      const qp = current ? `?model=${encodeURIComponent(current)}` : \"\";\n      window.location.href = `viewer.html${qp}`;\n    });\n    controls.insertBefore(openInspectorBtn, select);\n\n    // Animations UI: list available groups and allow playing one (styled)\n    const animSelect = document.createElement(\"select\");\n    animSelect.className = \"select\";\n    animSelect.style.webkitAppRegion = \"no-drag\";\n    animSelect.id = \"animSelect\";\n    animSelect.disabled = true;\n    const animPlayBtn = document.createElement(\"button\");\n    animPlayBtn.className = \"btn\";\n    animPlayBtn.textContent = \"\u25B6\";\n    animPlayBtn.title = \"\u041F\u0440\u043E\u0438\u0433\u0440\u0430\u0442\u044C \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u0443\u044E \u0433\u0440\u0443\u043F\u043F\u0443\";\n    animPlayBtn.style.webkitAppRegion = \"no-drag\";\n    animPlayBtn.disabled = true;\n    // controls.insertBefore(animPlayBtn, openInspectorBtn);\n    // controls.insertBefore(animSelect, openInspectorBtn);\n\n    // Voice TTS toggle\n    const voiceBtn = document.createElement(\"button\");\n    voiceBtn.className = \"btn\";\n    voiceBtn.textContent = \"Voice: Audio\";\n    voiceBtn.title = \"\u041E\u0437\u0432\u0443\u0447\u043A\u0430 \u0444\u0440\u0430\u0437 (TTS)\";\n    voiceBtn.style.webkitAppRegion = \"no-drag\";\n    controls.insertBefore(voiceBtn, openInspectorBtn);\n\n    // removed secondary viewer button\n\n    let model = null;\n    let motionEntries = [];\n    let availableGroups = [];\n    let lipSyncAvailable = false;\n    let lipSyncEnabled = true;\n    let lipSyncState = {\n      stream: null,\n      audioContext: null,\n      source: null,\n      analyser: null,\n      data: null,\n      raf: null,\n    };\n\n    function setMouthOpenParam(targetModel, value) {\n      if (!targetModel) return false;\n      const v = Math.max(0, Math.min(1, value));\n      // Try Cubism4 core\n      try {\n        const core =\n          targetModel.internalModel && targetModel.internalModel.coreModel;\n        if (core) {\n          if (typeof core.setParameterById === \"function\") {\n            core.setParameterById(\"ParamMouthOpenY\", v);\n            return true;\n          }\n          if (typeof core.setParameterValueById === \"function\") {\n            core.setParameterValueById(\"ParamMouthOpenY\", v);\n            return true;\n          }\n          if (\n            typeof core.getParameterIndexById === \"function\" &&\n            typeof core.setParameterValueByIndex === \"function\"\n          ) {\n            const idx = core.getParameterIndexById(\"ParamMouthOpenY\");\n            if (idx >= 0) {\n              core.setParameterValueByIndex(idx, v);\n              return true;\n            }\n          }\n        }\n      } catch (e) {}\n      // Try Cubism2 API\n      try {\n        const c2 =\n          (targetModel.internalModel && targetModel.internalModel.coreModel) ||\n          targetModel;\n        if (c2 && typeof c2.setParamFloat === \"function\") {\n          c2.setParamFloat(\"PARAM_MOUTH_OPEN_Y\", v);\n          return true;\n        }\n      } catch (e) {}\n      // Some wrappers might expose direct method\n      try {\n        if (typeof targetModel.setParamFloat === \"function\") {\n          targetModel.setParamFloat(\"PARAM_MOUTH_OPEN_Y\", v);\n          return true;\n        }\n      } catch (e) {}\n      return false;\n    }\n\n    // --- TTS (Voice) ---\n    let voiceEnabled = true;\n    let voiceMode = \"audio\"; // 'audio' | 'tts' | 'off'\n    let preferredVoice = null;\n    const tts = {\n      pickVoice() {\n        try {\n          const voices = window.speechSynthesis\n            ? window.speechSynthesis.getVoices()\n            : [];\n          const ru = voices.find((v) => /ru/i.test(v.lang || \"\"));\n          preferredVoice = ru || voices[0] || null;\n        } catch {}\n      },\n      say(text) {\n        if (!voiceEnabled) return null;\n        try {\n          if (!window.speechSynthesis) return;\n          if (!preferredVoice) this.pickVoice();\n          const u = new SpeechSynthesisUtterance(String(text || \"\"));\n          if (preferredVoice) u.voice = preferredVoice;\n          u.lang = (preferredVoice && preferredVoice.lang) || \"ru-RU\";\n          u.rate = 1.0;\n          u.pitch = 1.0;\n          u.volume = 1.0;\n          window.speechSynthesis.cancel();\n          window.speechSynthesis.speak(u);\n          return u;\n        } catch {}\n        return null;\n      },\n    };\n    if (window.speechSynthesis) {\n      window.speechSynthesis.onvoiceschanged = () => tts.pickVoice();\n      tts.pickVoice();\n    }\n\n    const TTS_PHRASES = {\n      start: [\n        \"\u041D\u0443 \u0434\u0430\u0432\u0430\u0439, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439 \u0445\u043E\u0442\u044F \u0431\u044B \u0440\u0430\u0437 \u043D\u0435 \u043E\u0431\u043E\u0441\u0440\u0430\u0442\u044C\u0441\u044F.\",\n        \"\u0422\u0430\u0439\u043C\u0435\u0440 \u043F\u043E\u0448\u0451\u043B, \u0442\u0430\u043A \u0447\u0442\u043E \u0445\u0432\u0430\u0442\u0438\u0442 \u0447\u0435\u0441\u0430\u0442\u044C \u044F\u0439\u0446\u0430 \u2014 \u0440\u0430\u0431\u043E\u0442\u0430\u0439.\",\n        \"\u0424\u043E\u043A\u0443\u0441, \u0431\u043B\u0438\u043D! \u0422\u044B \u0441\u044E\u0434\u0430 \u043A\u043E\u0434\u0438\u0442\u044C \u043F\u0440\u0438\u0448\u0451\u043B, \u0430 \u043D\u0435 \u0432 \u043F\u043E\u0442\u043E\u043B\u043E\u043A \u043F\u044F\u043B\u0438\u0442\u044C\u0441\u044F.\",\n        \"\u0417\u0430\u043F\u0443\u0441\u043A\u0430\u0435\u043C. \u0415\u0441\u043B\u0438 \u043E\u043F\u044F\u0442\u044C \u0432\u0441\u0451 \u043F\u0440\u043E\u0441\u0440\u0451\u0448\u044C \u2014 \u044D\u0442\u043E \u0443\u0436\u0435 \u043D\u0435 \u043C\u043E\u044F \u0432\u0438\u043D\u0430.\",\n        \"\u0420\u0430\u0431\u043E\u0442\u0430 \u043D\u0430\u0447\u0430\u043B\u0430\u0441\u044C. \u0410 \u0442\u044B \u0432\u043E\u043E\u0431\u0449\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C \u0443\u043C\u0435\u0435\u0448\u044C?\",\n      ],\n      finish: [\n        \"\u041E, \u0441\u043C\u043E\u0442\u0440\u0438-\u043A\u0430, \u0434\u043E\u0436\u0438\u043B! \u042F \u0434\u0443\u043C\u0430\u043B \u0442\u044B \u0441\u0434\u043E\u0445\u043D\u0435\u0448\u044C \u043D\u0430 \u0441\u0435\u0440\u0435\u0434\u0438\u043D\u0435.\",\n        \"\u041F\u043E\u0437\u0434\u0440\u0430\u0432\u043B\u044F\u044E, \u0442\u044B \u0441\u0434\u0435\u043B\u0430\u043B \u0440\u043E\u0432\u043D\u043E \u043D\u0438\u0445\u0440\u0435\u043D\u0430. \u041D\u043E \u043A\u0440\u0430\u0441\u0438\u0432\u043E.\",\n        \"\u0422\u0430\u0439\u043C\u0435\u0440 \u0437\u0430\u043A\u043E\u043D\u0447\u0438\u043B\u0441\u044F. \u0410 \u0442\u043E\u043B\u043A\u0443-\u0442\u043E? \u041A\u043E\u0434 \u0432\u0441\u0451 \u0435\u0449\u0451 \u0433\u043E\u0432\u043D\u043E.\",\n        \"\u041D\u0443 \u0445\u043E\u0442\u044C \u0447\u0442\u043E-\u0442\u043E \u0434\u043E\u0432\u0451\u043B \u0434\u043E \u043A\u043E\u043D\u0446\u0430. \u0427\u0438\u0441\u0442\u043E \u0440\u0435\u043A\u043E\u0440\u0434.\",\n        \"\u041C\u043E\u043B\u043E\u0434\u0435\u0446, \u0433\u0435\u0440\u043E\u0439. \u0418\u0434\u0438 \u043E\u0442\u0434\u043E\u0445\u043D\u0438, \u043F\u043E\u043A\u0430 \u043D\u0435 \u043F\u0435\u0440\u0435\u0434\u043E\u0445.\",\n      ],\n      break: [\n        \"\u0412\u0441\u0442\u0430\u0432\u0430\u0439, \u0430\u043C\u0451\u0431\u0430. \u0422\u044B \u0441\u043A\u043E\u0440\u043E \u0441\u043E \u0441\u0442\u0443\u043B\u043E\u043C \u0441\u0440\u0430\u0441\u0442\u0451\u0448\u044C\u0441\u044F.\",\n        \"\u0414\u0430 \u0441\u0434\u0435\u043B\u0430\u0439 \u0443\u0436\u0435 \u0440\u0430\u0437\u043C\u0438\u043D\u043A\u0443, \u0430 \u0442\u043E \u0441\u0438\u0434\u0438\u0448\u044C \u043A\u0430\u043A \u0432\u044B\u0441\u043E\u0445\u0448\u0438\u0439 \u0434\u0435\u0434.\",\n        \"\u0421\u0445\u043E\u0434\u0438 \u043F\u043E\u043F\u0435\u0439 \u0432\u043E\u0434\u044B, \u043C\u043E\u0436\u0435\u0442 \u043C\u043E\u0437\u0433 \u043F\u0440\u043E\u043C\u043E\u0435\u0442.\",\n        \"\u041F\u0435\u0440\u0435\u0440\u044B\u0432. \u0425\u043E\u0442\u044F \u0442\u0435\u0431\u0435 \u0431\u044B \u043F\u043E\u0436\u0438\u0437\u043D\u0435\u043D\u043D\u044B\u0439 \u043E\u0444\u043E\u0440\u043C\u0438\u0442\u044C.\",\n        \"\u0413\u043B\u0430\u0437\u0430 \u0437\u0430\u043A\u0440\u044B\u0432\u0430\u0439, \u0430 \u0442\u043E \u0442\u0430\u043A\u0438\u043C\u0438 \u0442\u0435\u043C\u043F\u0430\u043C\u0438 \u0442\u044B \u043E\u0441\u043B\u0435\u043F\u043D\u0435\u0448\u044C, \u0438 \u044F \u043D\u0430\u043A\u043E\u043D\u0435\u0446 \u043E\u0442 \u0442\u0435\u0431\u044F \u043E\u0442\u0434\u043E\u0445\u043D\u0443.\",\n      ],\n      xp: [\n        \"+XP, \u043D\u043E \u0442\u044B \u0432\u0441\u0451 \u0440\u0430\u0432\u043D\u043E \u0438\u0434\u0438\u043E\u0442.\",\n        \"\u041D\u0443 \u0432\u043E\u0442, \u043A\u0430\u0447\u043D\u0443\u043B\u0441\u044F. \u0416\u0430\u043B\u044C, \u0445\u0430\u0440\u0438\u0437\u043C\u044B \u044D\u0442\u043E \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u0438\u0442.\",\n        \"+1 \u043A \u0441\u043A\u0438\u043B\u043B\u0443. \u041F\u0440\u0430\u0432\u0434\u0430, \u0442\u043E\u043B\u043A\u0443 \u043E\u0442 \u0442\u0435\u0431\u044F \u043A\u0430\u043A \u043E\u0442 \u0434\u043E\u0445\u043B\u043E\u0439 \u043C\u044B\u0448\u0438.\",\n        \"\u041F\u043E\u0437\u0434\u0440\u0430\u0432\u043B\u044F\u044E, \u0435\u0449\u0451 \u0448\u0430\u0433 \u043A \u0437\u0432\u0430\u043D\u0438\u044E \u043D\u0435\u043F\u043E\u043B\u043D\u044B\u0439 \u0434\u0435\u0433\u0435\u043D\u0435\u0440\u0430\u0442.\",\n        \"\u041D\u0443 \u0445\u043E\u0442\u044C \u0446\u0438\u0444\u0440\u044B \u0440\u0430\u0441\u0442\u0443\u0442, \u0432 \u043E\u0442\u043B\u0438\u0447\u0438\u0435 \u043E\u0442 \u0442\u0432\u043E\u0435\u0433\u043E \u043C\u043E\u0437\u0433\u0430.\",\n      ],\n      fun: [\n        \"\u041E\u043F\u044F\u0442\u044C \u0434\u0435\u0431\u0430\u0436\u0438\u0448\u044C? \u0422\u044B \u0436\u0435 \u0437\u043D\u0430\u0435\u0448\u044C, \u0447\u0442\u043E \u0440\u0443\u043A\u0438 \u0443 \u0442\u0435\u0431\u044F \u0438\u0437 \u0436\u043E\u043F\u044B.\",\n        \"\u041A\u043E\u0433\u0434\u0430 \u0440\u0435\u043B\u0438\u0437? \u041D\u0438\u043A\u043E\u0433\u0434\u0430. \u041F\u043E\u0442\u043E\u043C\u0443 \u0447\u0442\u043E \u0441 \u0442\u043E\u0431\u043E\u0439 \u2014 \u043D\u0435\u0440\u0435\u0430\u043B\u044C\u043D\u043E.\",\n        \"\u0422\u044B \u0443\u0432\u0435\u0440\u0435\u043D, \u0447\u0442\u043E \u044D\u0442\u043E \u043A\u043E\u043C\u043F\u0438\u043B\u0438\u0440\u0443\u0435\u0442\u0441\u044F? \u042F \u0431\u044B \u043D\u0430 \u0442\u0432\u043E\u0451\u043C \u043C\u0435\u0441\u0442\u0435 \u043F\u0440\u043E\u0432\u0435\u0440\u0438\u043B \u043C\u043E\u043B\u0438\u0442\u0432\u043E\u0439.\",\n        \"\u0421\u0438\u0434\u0438\u0448\u044C \u0442\u0430\u043A\u043E\u0439 \u0443\u043C\u043D\u044B\u0439, \u0430 \u043D\u0430 \u0434\u0435\u043B\u0435 \u2014 \u043A\u043B\u0430\u0432\u0438\u0430\u0442\u0443\u0440\u043D\u044B\u0439 \u0431\u043E\u043C\u0436.\",\n        \"\u0413\u043B\u0430\u0437\u0430 \u0443 \u0442\u0435\u0431\u044F \u043A\u0440\u0430\u0441\u043D\u044B\u0435\u2026 \u044D\u0442\u043E \u043E\u0442 \u043A\u043E\u0434\u0430 \u0438\u043B\u0438 \u043E\u0442 \u043F\u043E\u0440\u043D\u0445\u0430\u0431\u0430?\",\n        \"\u0421\u043C\u043E\u0442\u0440\u0438, \u043A\u0430\u043A\u043E\u0439 \u043A\u043E\u043C\u043C\u0438\u0442! \u0414\u0430 \u0437\u0430 \u044D\u0442\u043E \u043D\u0430 GitHub \u0441\u043C\u0435\u044F\u0442\u044C\u0441\u044F \u0431\u0443\u0434\u0443\u0442 \u0433\u043E\u0434\u0430\u043C\u0438.\",\n        \"\u0414\u0430-\u0434\u0430, \u0421\u044D\u043C\u043F\u0430\u0439\u2026 \u0440\u0443\u043A\u043E\u0436\u043E\u043F\u044B\u0439 \u0421\u044D\u043C\u043F\u0430\u0439.\",\n      ],\n    };\n\n    function sayRandom(list) {\n      try {\n        if (!Array.isArray(list) || !list.length) return null;\n        const pick = list[Math.floor(Math.random() * list.length)];\n        return pick;\n      } catch {}\n      return null;\n    }\n\n    // --- Audio files for phrases ---\n    const VOICE_AUDIO_DEFAULT = {\n      start: [],\n      finish: [],\n      break: [],\n      xp: [],\n      fun: [],\n    };\n    let VOICE_AUDIO = { ...VOICE_AUDIO_DEFAULT };\n    const audioCache = new Map();\n    function getAudio(url) {\n      let a = audioCache.get(url);\n      if (!a) {\n        a = new Audio(url);\n        a.preload = \"auto\";\n        audioCache.set(url, a);\n      }\n      return a;\n    }\n    let currentAudio = null;\n    function playAudioCategory(cat) {\n      return new Promise((resolve) => {\n        try {\n          const list = (VOICE_AUDIO && VOICE_AUDIO[cat]) || [];\n          if (!Array.isArray(list) || !list.length) return resolve(false);\n          const pick = list[Math.floor(Math.random() * list.length)];\n          if (!pick) return resolve(false);\n          if (currentAudio) {\n            try {\n              currentAudio.pause();\n              currentAudio.currentTime = 0;\n            } catch (e) {}\n          }\n          const a = getAudio(pick);\n          currentAudio = a;\n          a.currentTime = 0;\n          const p = a.play();\n          if (p && typeof p.then === \"function\") {\n            p.then(() => resolve(true)).catch(() => resolve(false));\n          } else {\n            resolve(true);\n          }\n        } catch (e) {\n          resolve(false);\n        }\n      });\n    }\n\n    // LipSync driven by phrase playback (audio element) or speech synthesis\n    function getForcePriority() {\n      try {\n        const ns = PIXI.live2d && PIXI.live2d.MotionPriority;\n        return (ns && (ns.FORCE || ns.PriorityForce)) || 3;\n      } catch (e) {\n        return 3;\n      }\n    }\n    function ensureAudioContext() {\n      try {\n        const AudioCtx =\n          window.AudioContext || (window as any).webkitAudioContext || null;\n        if (!AudioCtx) return null;\n        if (!lipSyncState.audioContext)\n          lipSyncState.audioContext = new AudioCtx();\n        return lipSyncState.audioContext;\n      } catch {\n        return null;\n      }\n    }\n\n    function startLipSyncForAudio(audioEl) {\n      if (!audioEl || !model) return;\n      const ctx = ensureAudioContext();\n      if (!ctx) return;\n      try {\n        if (lipSyncState.source && lipSyncState.source.disconnect)\n          lipSyncState.source.disconnect();\n      } catch (e) {}\n      try {\n        const source = ctx.createMediaElementSource(audioEl);\n        const analyser = ctx.createAnalyser();\n        analyser.fftSize = 2048;\n        const data = new Uint8Array(analyser.fftSize);\n        source.connect(analyser);\n        analyser.connect(ctx.destination);\n        lipSyncState.source = source;\n        lipSyncState.analyser = analyser;\n        lipSyncState.data = data;\n        const update = () => {\n          if (!lipSyncEnabled) return;\n          try {\n            analyser.getByteTimeDomainData(data);\n            let min = 255,\n              max = 0;\n            for (let i = 0; i < data.length; i++) {\n              const v = data[i];\n              if (v < min) min = v;\n              if (v > max) max = v;\n            }\n            let amp = (max - min) / 255;\n            amp = Math.pow(Math.max(0, amp - 0.02) * 1.8, 1.2);\n            if (amp > 1) amp = 1;\n            setMouthOpenParam(window.__live2d_model, amp);\n          } catch (e) {}\n          if (audioEl.ended || audioEl.paused) {\n            setMouthOpenParam(window.__live2d_model, 0);\n            return;\n          }\n          lipSyncState.raf = requestAnimationFrame(update);\n        };\n        lipSyncEnabled = true;\n        lipSyncState.raf = requestAnimationFrame(update);\n      } catch (e) {}\n    }\n\n    function startLipSyncForSpeech(utterance) {\n      if (!model) return;\n      const tick = () => {\n        if (!lipSyncEnabled) return;\n        const speaking =\n          window.speechSynthesis && window.speechSynthesis.speaking;\n        if (!speaking) {\n          setMouthOpenParam(window.__live2d_model, 0);\n          return;\n        }\n        const t = performance.now() / 1000;\n        const amp = Math.max(\n          0,\n          Math.min(1, (Math.sin(t * 9) + Math.sin(t * 13) * 0.5 + 1) / 2)\n        );\n        setMouthOpenParam(window.__live2d_model, amp * 0.9);\n        lipSyncState.raf = requestAnimationFrame(tick);\n      };\n      lipSyncEnabled = true;\n      lipSyncState.raf = requestAnimationFrame(tick);\n      if (utterance) {\n        try {\n          utterance.onend = () => setMouthOpenParam(window.__live2d_model, 0);\n        } catch (e) {}\n      }\n    }\n\n    async function loadPhrasesJson() {\n      try {\n        const resp = await fetch(\"./phrases.json\", { cache: \"no-cache\" });\n        if (!resp.ok) return;\n        const data = await resp.json();\n        // Accept either {cat: [audioUrls]} or {cat: {audio: [...], text: [...]}}\n        const mergedAudio = { ...VOICE_AUDIO_DEFAULT };\n        const mergedText = { ...TTS_PHRASES };\n        for (const k of Object.keys(mergedAudio)) {\n          const v = data[k];\n          if (Array.isArray(v)) mergedAudio[k] = v;\n          else if (v && Array.isArray(v.audio)) mergedAudio[k] = v.audio;\n          if (v && Array.isArray(v.text)) mergedText[k] = v.text;\n        }\n        VOICE_AUDIO = mergedAudio;\n        for (const k of Object.keys(mergedText)) {\n          if (Array.isArray(mergedText[k])) TTS_PHRASES[k] = mergedText[k];\n        }\n      } catch (e) {}\n    }\n    loadPhrasesJson();\n\n    // \u0412\u043D\u0435\u0448\u043D\u0438\u0435 \u0445\u0435\u043B\u043F\u0435\u0440\u044B \u0430\u043D\u0438\u043C\u0430\u0446\u0438\u0439 \u0434\u043B\u044F \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u0438\u044F \u0438\u0437 \u043B\u044E\u0431\u043E\u0433\u043E \u043C\u0435\u0441\u0442\u0430\n    function playRandomNonIdle() {\n      if (!window.__live2d_model || !motionEntries.length) return;\n      const candidates = motionEntries.filter((m) => {\n        const g = String(m.group || \"\").toLowerCase();\n        const f = String(m.file || \"\").toLowerCase();\n        return g !== \"idle\" && !f.includes(\"idle\");\n      });\n      const list = candidates.length ? candidates : motionEntries;\n      const pick = list[Math.floor(Math.random() * list.length)];\n      try {\n        const mm =\n          window.__live2d_model.internalModel &&\n          window.__live2d_model.internalModel.motionManager;\n        const pr = getForcePriority();\n        if (mm && typeof mm.startMotion === \"function\")\n          mm.startMotion(pick.group, pick.index, pr);\n        else if (mm && typeof mm.startRandomMotion === \"function\")\n          mm.startRandomMotion(pick.group, pr);\n      } catch (e) {}\n    }\n\n    function interruptAndPlayRandomNonIdle() {\n      const m = window.__live2d_model;\n      if (!m) return;\n      try {\n        const mm = m.internalModel && m.internalModel.motionManager;\n        if (mm) {\n          if (typeof mm.stopAllMotions === \"function\") mm.stopAllMotions();\n          else if (\n            mm._motionQueueManager &&\n            typeof mm._motionQueueManager.stopAllMotions === \"function\"\n          )\n            mm._motionQueueManager.stopAllMotions();\n        }\n      } catch (e) {}\n      playRandomNonIdle();\n      try {\n        snoozeIdle(m, 6000);\n      } catch (e) {}\n    }\n\n    function speakCategory(cat) {\n      if (!voiceEnabled || !cat) return;\n      if (voiceMode === \"audio\") {\n        playAudioCategory(cat).then((ok) => {\n          if (ok && currentAudio) {\n            if (lipSyncEnabled) startLipSyncForAudio(currentAudio);\n            // trigger animation immediately on voice start\n            interruptAndPlayRandomNonIdle();\n            try {\n              currentAudio.addEventListener(\n                \"play\",\n                () => interruptAndPlayRandomNonIdle(),\n                { once: true }\n              );\n              currentAudio.addEventListener(\n                \"playing\",\n                () => interruptAndPlayRandomNonIdle(),\n                { once: true }\n              );\n            } catch (e) {}\n            if (!currentAudio.paused) {\n              setTimeout(() => interruptAndPlayRandomNonIdle(), 0);\n            }\n          } else if (!ok) {\n            // \u041D\u0435\u0442 \u0430\u0443\u0434\u0438\u043E \u2014 \u043F\u0440\u043E\u0441\u0442\u043E \u0437\u0430\u043F\u0443\u0441\u0442\u0438\u043C \u0440\u0435\u0430\u043A\u0446\u0438\u044E \u0430\u043D\u0438\u043C\u0430\u0446\u0438\u0435\u0439\n            interruptAndPlayRandomNonIdle();\n          }\n        });\n        return;\n      }\n      if (voiceMode === \"tts\") {\n        const text = sayRandom(TTS_PHRASES[cat] || []);\n        if (text) {\n          const u = tts.say(text);\n          try {\n            if (u) u.onstart = () => interruptAndPlayRandomNonIdle();\n          } catch (e) {}\n          interruptAndPlayRandomNonIdle();\n          if (lipSyncEnabled) startLipSyncForSpeech(u);\n        }\n        return;\n      }\n    }\n\n    voiceBtn.addEventListener(\"click\", () => {\n      if (voiceMode === \"audio\") {\n        voiceMode = \"off\";\n        voiceBtn.textContent = \"Voice: Off\";\n      } else {\n        voiceMode = \"audio\";\n        voiceBtn.textContent = \"Voice: Audio\";\n      }\n      voiceEnabled = voiceMode !== \"off\";\n    });\n\n    async function startLipSync() {\n      if (!window.navigator || !navigator.mediaDevices) return;\n      if (!model) return;\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          audio: true,\n          video: false,\n        });\n        const AudioCtx =\n          window.AudioContext || (window as any).webkitAudioContext || null;\n        if (!AudioCtx) return;\n        const audioContext = new AudioCtx();\n        const source = audioContext.createMediaStreamSource(stream);\n        const analyser = audioContext.createAnalyser();\n        analyser.fftSize = 2048;\n        const data = new Uint8Array(analyser.fftSize);\n        source.connect(analyser);\n        lipSyncState = {\n          stream,\n          audioContext,\n          source,\n          analyser,\n          data,\n          raf: null,\n        };\n\n        const update = () => {\n          if (!lipSyncEnabled) return;\n          try {\n            analyser.getByteTimeDomainData(data);\n            // Compute peak-to-peak amplitude normalized\n            let min = 255,\n              max = 0;\n            for (let i = 0; i < data.length; i++) {\n              const v = data[i];\n              if (v < min) min = v;\n              if (v > max) max = v;\n            }\n            let amp = (max - min) / 255; // 0..~1\n            // Smooth and scale\n            amp = Math.pow(Math.max(0, amp - 0.02) * 1.8, 1.2);\n            if (amp > 1) amp = 1;\n            setMouthOpenParam(window.__live2d_model, amp);\n          } catch (e) {}\n          lipSyncState.raf = requestAnimationFrame(update);\n        };\n        lipSyncEnabled = true;\n\n        update();\n      } catch (e) {}\n    }\n\n    function stopLipSync() {\n      try {\n        if (lipSyncState && lipSyncState.raf != null) {\n          cancelAnimationFrame(lipSyncState.raf as any);\n          lipSyncState.raf = null;\n        }\n      } catch (e) {}\n      try {\n        if (\n          lipSyncState &&\n          lipSyncState.source &&\n          lipSyncState.source.disconnect\n        ) {\n          lipSyncState.source.disconnect();\n        }\n      } catch (e) {}\n      try {\n        if (lipSyncState && lipSyncState.stream) {\n          lipSyncState.stream.getTracks().forEach((t) => t.stop());\n        }\n      } catch (e) {}\n      try {\n        setMouthOpenParam(window.__live2d_model, 0);\n      } catch (e) {}\n    }\n\n    // LipSync \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043A\u043B\u044E\u0447\u0435\u043D \u0431\u0435\u0437 UI-\u043A\u043D\u043E\u043F\u043A\u0438\n\n    function refreshAnimationsUI() {\n      const placeholder = document.createElement(\"option\");\n      placeholder.value = \"\";\n      placeholder.textContent = \"\u0410\u043D\u0438\u043C\u0430\u0446\u0438\u0438\";\n      animSelect.innerHTML = \"\";\n      animSelect.appendChild(placeholder);\n\n      const entries = Array.isArray(motionEntries) ? motionEntries.slice() : [];\n\n      const niceName = (filePath) => {\n        try {\n          const file = decodeURIComponent(String(filePath || \"\"))\n            .split(\"/\")\n            .pop();\n          if (!file) return \"motion\";\n          return file\n            .replace(/\\.(motion3|mtn|json)$/i, \"\")\n            .replace(/[_.]+/g, \" \")\n            .trim();\n        } catch {\n          return \"motion\";\n        }\n      };\n\n      if (entries.length) {\n        entries.forEach((e) => {\n          const opt = document.createElement(\"option\");\n          opt.value = `${e.group}::${e.index}`;\n          opt.dataset.group = String(e.group || \"\");\n          opt.dataset.index = String(e.index);\n          const labelCore = niceName(e.file);\n          const groupLabel = String(e.group || \"\").trim();\n          opt.textContent = groupLabel\n            ? `${groupLabel}: ${labelCore}`\n            : labelCore;\n          animSelect.appendChild(opt);\n        });\n        animSelect.disabled = false;\n        animPlayBtn.disabled = false;\n        return;\n      }\n\n      // Fallback to group-based listing if we have no parsed entries\n      const groups = Array.from(new Set([...(availableGroups || [])])).filter(\n        (g) => String(g).length > 0\n      );\n      // Try to synthesize per-index entries from runtime definitions\n      let synthesized = false;\n      try {\n        const mm =\n          model && model.internalModel && model.internalModel.motionManager;\n        const defs =\n          mm && (mm.definitions || mm._definitions || mm._motions || null);\n        if (defs) {\n          for (const g of groups) {\n            let length = 0;\n            if (Array.isArray(defs[g])) length = defs[g].length || 0;\n            else if (defs[g] && typeof defs[g].length === \"number\")\n              length = defs[g].length;\n            else if (typeof defs.get === \"function\") {\n              const arr = defs.get(g);\n              length = (arr && arr.length) || 0;\n            }\n            if (length > 0) {\n              for (let i = 0; i < length; i++) {\n                const opt = document.createElement(\"option\");\n                opt.value = `${g}::${i}`;\n                opt.dataset.group = String(g);\n                opt.dataset.index = String(i);\n                opt.textContent = `${g}: motion ${i + 1}`;\n                animSelect.appendChild(opt);\n              }\n              synthesized = true;\n            }\n          }\n        }\n      } catch (e) {}\n      if (!synthesized) {\n        for (const g of groups) {\n          const opt = document.createElement(\"option\");\n          opt.value = g;\n          opt.textContent = g;\n          animSelect.appendChild(opt);\n        }\n      }\n      const enabled = groups.length > 0;\n      animSelect.disabled = !enabled;\n      animPlayBtn.disabled = !enabled;\n    }\n\n    function getGroupsFromManager(mm) {\n      try {\n        const defs =\n          mm && (mm.definitions || mm._definitions || mm._motions || {});\n        return Object.keys(defs || {});\n      } catch (e) {\n        return [];\n      }\n    }\n\n    function scheduleGroupRefresh() {\n      let attempts = 16;\n      const poll = () => {\n        if (!model) return;\n        try {\n          const mm = model.internalModel && model.internalModel.motionManager;\n          const groups = getGroupsFromManager(mm);\n          if (groups && groups.length) {\n            availableGroups = Array.from(\n              new Set([...(availableGroups || []), ...groups])\n            );\n            refreshAnimationsUI();\n            return;\n          }\n        } catch (e) {}\n        if (--attempts > 0) setTimeout(poll, 250);\n      };\n      poll();\n    }\n\n    function playSelectedAnimationGroup() {\n      if (!model) return;\n      if (!animSelect.value) return;\n      const mm = model.internalModel && model.internalModel.motionManager;\n\n      // If a specific motion (group+index) was selected, prefer that\n      const selectedOpt = animSelect.options[animSelect.selectedIndex];\n      const hasIndexSel =\n        selectedOpt && selectedOpt.dataset && selectedOpt.dataset.index != null;\n      let played = false;\n      if (hasIndexSel) {\n        const grp = selectedOpt.dataset.group || \"\";\n        const idx = parseInt(selectedOpt.dataset.index, 10);\n        try {\n          if (mm && typeof mm.startMotion === \"function\") {\n            mm.startMotion(grp, isFinite(idx) ? idx : 0, getForcePriority());\n            played = true;\n          }\n        } catch (e) {}\n        if (!played) {\n          try {\n            if (typeof model.motion === \"function\") {\n              model.motion(grp, isFinite(idx) ? idx : 0);\n              played = true;\n            }\n          } catch (e) {}\n        }\n        if (played) {\n          snoozeIdle(window.__live2d_model, 9000);\n          return;\n        }\n      }\n\n      // Otherwise treat value as a group and pick an index\n      const group = animSelect.value;\n      const pickIndex = () => {\n        // Prefer indices from parsed motionEntries\n        const candidates = (motionEntries || [])\n          .filter((e) => (e.group || \"\") === group)\n          .map((e) => e.index)\n          .filter((i) => typeof i === \"number\" && i >= 0);\n        if (candidates.length) {\n          return candidates[Math.floor(Math.random() * candidates.length)];\n        }\n        // Try to inspect runtime definitions\n        try {\n          const defs =\n            (mm && (mm.definitions || mm._definitions || mm._motions)) || null;\n          if (defs) {\n            if (Array.isArray(defs[group])) return 0;\n            if (defs[group] && typeof defs[group].length === \"number\") return 0;\n            if (typeof defs.get === \"function\") {\n              const arr = defs.get(group);\n              if (arr && arr.length) return 0;\n            }\n          }\n        } catch {}\n        return 0;\n      };\n\n      // Try available APIs in order\n      try {\n        if (mm && typeof mm.startMotion === \"function\") {\n          const idx = pickIndex();\n          mm.startMotion(group, idx, getForcePriority());\n          snoozeIdle(window.__live2d_model, 9000);\n          return;\n        }\n      } catch (e) {}\n      try {\n        if (mm && typeof mm.startRandomMotion === \"function\") {\n          mm.startRandomMotion(group, getForcePriority());\n          snoozeIdle(window.__live2d_model, 9000);\n          return;\n        }\n      } catch (e) {}\n      try {\n        if (typeof model.motion === \"function\") {\n          const idx = pickIndex();\n          try {\n            model.motion(group, idx);\n          } catch {\n            model.motion(group);\n          }\n          snoozeIdle(window.__live2d_model, 9000);\n          return;\n        }\n      } catch (e) {}\n    }\n\n    // animPlayBtn.addEventListener(\"click\", playSelectedAnimationGroup);\n    // animSelect.addEventListener(\"change\", () => {\n    //   // optional: auto-play on selection\n    //   playSelectedAnimationGroup();\n    // });\n\n    function getMotionEntriesFromJson(json, baseUrl) {\n      const entries = [];\n      const add = (group, arr) => {\n        (arr || []).forEach((m, idx) => {\n          if (typeof m === \"string\") {\n            entries.push({ group, index: idx, file: baseUrl + m });\n          } else if (m && (m.file || m.File)) {\n            const f = m.file || m.File;\n            entries.push({ group, index: idx, file: baseUrl + f });\n          }\n        });\n      };\n      try {\n        const m2 = json.motions || json.Motions || {};\n        for (const g of Object.keys(m2)) add(g, m2[g]);\n      } catch {}\n      try {\n        const m4 = (json.FileReferences && json.FileReferences.Motions) || {};\n        for (const g of Object.keys(m4)) add(g, m4[g]);\n      } catch {}\n      return entries;\n    }\n\n    function startIdleLoop(model, preferredGroups) {\n      if (!model) return;\n      try {\n        if (model.__idleTimer) {\n          clearInterval(model.__idleTimer);\n          model.__idleTimer = null;\n        }\n      } catch {}\n      const mm = model.internalModel && model.internalModel.motionManager;\n      if (!(mm && typeof mm.startRandomMotion === \"function\")) return;\n      // collect groups from settings if not provided\n      let groups = Array.isArray(preferredGroups)\n        ? preferredGroups.slice()\n        : [];\n      try {\n        const s = model.internalModel && model.internalModel.settings;\n        const motions = (s && s.motions) || {};\n        groups = Array.from(new Set([...groups, ...Object.keys(motions)]));\n      } catch {}\n      const defaults = [\n        \"Idle\",\n        \"idle\",\n        \"TapBody\",\n        \"TapHead\",\n        \"tap_body\",\n        \"tap_head\",\n      ];\n      const candidates = Array.from(new Set([...defaults, ...groups])).filter(\n        Boolean\n      );\n      const hasGroup = (g) => {\n        try {\n          const defs = mm.definitions || mm._definitions || mm._motions || {};\n          return !!defs[g];\n        } catch {\n          return true; // best-effort\n        }\n      };\n      let chosen = null;\n      for (const g of candidates) {\n        if (!hasGroup(g)) continue;\n        try {\n          mm.startRandomMotion(g);\n          chosen = g;\n          break;\n        } catch {}\n      }\n      if (!chosen) return;\n      model.__idleTimer = setInterval(() => {\n        try {\n          // stop if model replaced\n          if (!window.__live2d_model || window.__live2d_model !== model) {\n            clearInterval(model.__idleTimer);\n            model.__idleTimer = null;\n            return;\n          }\n          const cur = window.__live2d_model;\n          const curMM =\n            cur && cur.internalModel && cur.internalModel.motionManager;\n          if (curMM && typeof curMM.startRandomMotion === \"function\") {\n            curMM.startRandomMotion(chosen);\n          }\n        } catch {}\n      }, 12000);\n    }\n\n    // Cubism 4 often stores motions differently. Prefer explicit Idle motion3 file if present.\n    function startIdleLoopC4(model) {\n      if (!model) return;\n      try {\n        if (model.__idleTimer) {\n          clearInterval(model.__idleTimer);\n          model.__idleTimer = null;\n        }\n      } catch {}\n      const mm = model.internalModel && model.internalModel.motionManager;\n      if (!mm) return;\n\n      const entries = Array.isArray(motionEntries) ? motionEntries : [];\n      const idleEntries = entries.filter((e) => {\n        try {\n          const name = String(e.file || \"\").toLowerCase();\n          return name.includes(\"idle\");\n        } catch {\n          return false;\n        }\n      });\n\n      let chosen = null;\n      if (idleEntries.length) {\n        chosen = idleEntries[Math.floor(Math.random() * idleEntries.length)];\n      } else {\n        // Fallback: look for a group literally named Idle\n        try {\n          const defs = mm.definitions || mm._definitions || mm._motions || {};\n          const groups = Object.keys(defs || {});\n          const idleGroup = groups.find(\n            (g) => String(g).toLowerCase() === \"idle\"\n          );\n          if (idleGroup) chosen = { group: idleGroup, index: 0 };\n        } catch {}\n      }\n\n      if (!chosen) return;\n      // Start once and then repeat periodically\n      try {\n        if (typeof mm.startMotion === \"function\") {\n          mm.startMotion(chosen.group || \"Idle\", chosen.index || 0);\n        } else if (typeof mm.startRandomMotion === \"function\") {\n          mm.startRandomMotion(chosen.group || \"Idle\");\n        }\n      } catch {}\n      model.__idleTimer = setInterval(() => {\n        try {\n          if (!window.__live2d_model || window.__live2d_model !== model) {\n            clearInterval(model.__idleTimer);\n            model.__idleTimer = null;\n            return;\n          }\n          const cur = window.__live2d_model;\n          const curMM =\n            cur && cur.internalModel && cur.internalModel.motionManager;\n          if (!curMM) return;\n          if (typeof curMM.startMotion === \"function\") {\n            curMM.startMotion(chosen.group || \"Idle\", chosen.index || 0);\n          } else if (typeof curMM.startRandomMotion === \"function\") {\n            curMM.startRandomMotion(chosen.group || \"Idle\");\n          }\n        } catch {}\n      }, 12000);\n    }\n\n    // Temporarily pause idle loop and resume later\n    function snoozeIdle(modelRef, ms) {\n      try {\n        if (!modelRef) return;\n        if (modelRef.__idleTimer) {\n          clearInterval(modelRef.__idleTimer);\n          modelRef.__idleTimer = null;\n        }\n        if (modelRef.__idleSnooze) {\n          clearTimeout(modelRef.__idleSnooze);\n          modelRef.__idleSnooze = null;\n        }\n        modelRef.__idleSnooze = setTimeout(() => {\n          try {\n            if (!window.__live2d_model || window.__live2d_model !== modelRef)\n              return;\n            if (currentRuntime === \"c4\") startIdleLoopC4(modelRef);\n            else\n              startIdleLoop(\n                modelRef,\n                Array.from(\n                  new Set(\n                    (motionEntries || []).map((e) =>\n                      String(e.group || \"\").trim()\n                    )\n                  )\n                ).filter(Boolean)\n              );\n          } catch (e) {}\n        }, Math.max(2000, ms || 8000));\n      } catch (e) {}\n    }\n\n    // Dependencies loaders (idempotent)\n    let cubism2Ready = false;\n    let cubism4Ready = false;\n    let currentRuntime = null; // 'c2' | 'c4'\n    (window as any).__loadedRuntime = (window as any).__loadedRuntime || null;\n    async function ensureCubism4() {\n      if (currentRuntime === \"c4\" && PIXI.live2d) return;\n      if (!window.Live2DCubismCore) {\n        await loadScript(\n          \"https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js\"\n        );\n      }\n      if (!PIXI.live2d || !PIXI.live2d.Live2DModel) {\n        await loadScript(\n          \"https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/cubism4.min.js\"\n        );\n      }\n      cubism4Ready = true;\n      currentRuntime = \"c4\";\n      try {\n        if (!(window as any).__live2d_api_c4)\n          (window as any).__live2d_api_c4 = (PIXI as any).live2d;\n        (window as any).__loadedRuntime = \"c4\";\n        applyPixiLive2dPatches();\n      } catch (e) {}\n    }\n    async function ensureCubism2() {\n      if (currentRuntime === \"c2\" && PIXI.live2d) return;\n      if (!window.Live2D) {\n        await loadScript(\n          \"https://cdn.jsdelivr.net/gh/dylanNew/live2d/webgl/Live2D/lib/live2d.min.js\"\n        );\n      }\n      // load cubism2 build of the plugin (safe to load alongside cubism4)\n      if (!PIXI.live2d || !PIXI.live2d.Live2DModel) {\n        await loadScript(\n          \"https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/cubism2.min.js\"\n        );\n      }\n      cubism2Ready = true;\n      currentRuntime = \"c2\";\n      try {\n        if (!(window as any).__live2d_api_c2)\n          (window as any).__live2d_api_c2 = (PIXI as any).live2d;\n        (window as any).__loadedRuntime = \"c2\";\n        applyPixiLive2dPatches();\n      } catch (e) {}\n    }\n\n    // ---- Live2D loader/factory patches (based on live2d-viewer-web) ----\n    function applyPixiLive2dPatches() {\n      const ns = (PIXI as any).live2d;\n      if (!ns) return;\n      if ((window as any).__live2d_loader_patched) return;\n      (window as any).__live2d_loader_patched = true;\n\n      const {\n        Live2DLoader,\n        XHRLoader,\n        Live2DFactory,\n        InternalModel,\n        Cubism2ModelSettings,\n        Cubism4ModelSettings,\n      } = ns || {};\n      if (!Live2DLoader || !XHRLoader || !Live2DFactory) return;\n\n      const urlUtils = {\n        resolve: (baseUrl: string, relative: string) => {\n          try {\n            return new URL(relative, baseUrl).toString();\n          } catch {\n            return relative;\n          }\n        },\n      };\n\n      const getAlternativeURL = (url: string) => {\n        try {\n          if (/jsdelivr/i.test(url)) {\n            // https://cdn.jsdelivr.net/gh/Eikanya/Live2d-model@master/<path>\n            const m = url.match(\n              /cdn\\.jsdelivr\\.net\\/gh\\/Eikanya\\/Live2d-model@([^/]+)\\/(.*)$/i\n            );\n            if (m)\n              return `https://raw.githubusercontent.com/Eikanya/Live2d-model/${m[1]}/${m[2]}`;\n          }\n          if (/raw\\.githubusercontent\\.com/i.test(url)) {\n            // swap to jsdelivr master\n            const m = url.match(\n              /raw\\.githubusercontent\\.com\\/Eikanya\\/Live2d-model\\/([^/]+)\\/(.*)$/i\n            );\n            if (m)\n              return `https://cdn.jsdelivr.net/gh/Eikanya/Live2d-model@${m[1]}/${m[2]}`;\n          }\n        } catch {}\n        return url;\n      };\n\n      const ping = async (url: string) => {\n        try {\n          const r = await fetch(url, { method: \"HEAD\" });\n          return r.ok;\n        } catch {\n          return false;\n        }\n      };\n\n      const snakeCaseUpper = (s: string) => {\n        if (!s) return s;\n        // ParamAngleX -> PARAM_ANGLE_X\n        return String(s)\n          .replace(/([a-z0-9])([A-Z])/g, \"$1_$2\")\n          .replace(/[-\\s]+/g, \"_\")\n          .toUpperCase();\n      };\n\n      const unionBy = <T extends Record<string, any>>(\n        arr: T[] | undefined,\n        extras: T[],\n        key: string\n      ): T[] => {\n        const out: T[] = Array.isArray(arr) ? arr.slice() : [];\n        const seen = new Set(out.map((x) => String(x && x[key])));\n        for (const e of extras) {\n          const k = String(e && e[key]);\n          if (!seen.has(k)) {\n            seen.add(k);\n            out.push(e);\n          }\n        }\n        return out;\n      };\n\n      // Replace XHR loader to handle jsDelivr 403 fallback\n      try {\n        const idx = Live2DLoader.middlewares.indexOf(XHRLoader.loader);\n        if (idx >= 0) {\n          Live2DLoader.middlewares[idx] = async (context: any, next: any) => {\n            const url = context.settings\n              ? context.settings.resolveURL(context.url)\n              : context.url;\n            try {\n              await XHRLoader.loader(context, next);\n              return;\n            } catch (e: any) {\n              if (!(e && e.status === 403 && /jsdelivr/i.test(url))) {\n                throw e;\n              }\n              try {\n                console.warn(\n                  \"[live2d] 403 from jsDelivr, switching alternative URL\"\n                );\n              } catch {}\n            }\n            context.url = getAlternativeURL(url);\n            await XHRLoader.loader(context, next);\n            return next();\n          };\n        }\n      } catch {}\n\n      // Patches table (subset)\n      const patches: Array<{\n        search: string;\n        replace?: (jsonText: string, url: string) => string;\n        patch?: (json: any, url: string) => void | Promise<void>;\n        patchInternalModel?: (internalModel: any) => void | Promise<void>;\n      }> = [\n        {\n          search: \"\u9B42\u5668\u5B66\u9662\",\n          replace(jsonText: string) {\n            return jsonText.replace(/mtn\"([^,])/gm, 'mtn\",\"$1');\n          },\n        },\n        {\n          search: \"\u5C11\u5973\u524D\u7EBF\",\n          async patch(json: any, url: string) {\n            extractCubism2IdleMotions(json, [\"daiji\"]);\n            if (!json.name) {\n              json.name = folderName(\n                url.replace(/(normal|destroy)\\.model\\.json/, \"\")\n              );\n            }\n            if (json.motions?.idle?.length) {\n              const motion0 = json.motions.idle[0] || {};\n              if (motion0.file && motion0.file.startsWith(\"daiji\")) {\n                const ok = await ping(urlUtils.resolve(url, motion0.file));\n                if (!ok) motion0.file = \"motions/\" + motion0.file;\n              }\n            }\n          },\n        },\n        {\n          search: \"\u30A2\u30F3\u30CE\u30A6\u30F3\u30D6\u30E9\u30A4\u30C9\",\n          async patch(json: any, url: string) {\n            if (json.FileReferences?.Textures?.length === 0) {\n              const exists = await ping(\n                urlUtils.resolve(url, \"textures/texture_00.png\")\n              );\n              json.FileReferences.Textures.push(\n                exists ? \"textures/texture_00.png\" : \"textures/texture_00 .png\"\n              );\n            }\n            extractCubism4IdleMotions(json, [\"home\", \"gacha\"]);\n          },\n        },\n        {\n          search: \"\u51CD\u4EAC\",\n          async patch(json: any, url: string) {\n            const correctTexture = async (tex: string) =>\n              (await ping(urlUtils.resolve(url, tex)))\n                ? tex\n                : tex.replace(\"/texture\", \"/android/texture\");\n            if (\n              Cubism2ModelSettings &&\n              Cubism2ModelSettings.isValidJSON?.(json)\n            ) {\n              if (json.textures)\n                json.textures = await Promise.all(\n                  json.textures.map(correctTexture)\n                );\n              if (json.motions) {\n                for (const grp of Object.values(json.motions) as any[][]) {\n                  if (grp?.length)\n                    for (const m of grp) {\n                      m.file = m.file ?? m.File;\n                      delete m.File;\n                    }\n                }\n                if (!json.motions.idle?.length && json.motions[\"\"]) {\n                  json.motions.idle = json.motions[\"\"].filter(\n                    (m: any) => m.file && m.file.includes(\"loop\")\n                  );\n                }\n              }\n            } else if (\n              Cubism4ModelSettings &&\n              Cubism4ModelSettings.isValidJSON?.(json)\n            ) {\n              if (json.FileReferences?.Textures)\n                json.FileReferences.Textures = await Promise.all(\n                  json.FileReferences.Textures.map(correctTexture)\n                );\n              if (json.FileReferences?.Motions) {\n                if (\n                  !json.FileReferences.Motions.Idle?.length &&\n                  json.FileReferences.Motions[\"\"]\n                ) {\n                  json.FileReferences.Motions.Idle =\n                    json.FileReferences.Motions[\"\"].filter(\n                      (m: any) => m.File && m.File.includes(\"loop\")\n                    );\n                }\n              }\n            }\n          },\n        },\n        {\n          search: \"\u5929\u547D\u4E4B\u5B50\",\n          patch(json: any) {\n            if (json.motions?.[\"\"]?.length && !json.motions?.idle?.length)\n              json.motions.idle = json.motions[\"\"].map((m: any) => ({ ...m }));\n          },\n        },\n        {\n          search: \"\u78A7\u84DD\u822A\u7EBF\",\n          patch(json: any) {\n            extractCubism4IdleMotions(json, [\"idle\"]);\n          },\n        },\n        {\n          search: \"\u5C11\u5973\u5496\u5561\u67AA\",\n          patch(json: any) {\n            extractCubism4IdleMotions(json, [\"stand\"]);\n          },\n          patchInternalModel(internalModel: any) {\n            for (const prop of Object.keys(internalModel))\n              if (prop.startsWith(\"idParam\"))\n                (internalModel as any)[prop] = snakeCaseUpper(\n                  (internalModel as any)[prop]\n                );\n          },\n        },\n        {\n          search: \"princesses\",\n          patch(json: any) {\n            extractCubism2IdleMotions(json, [\"default\", \"loop\"]);\n          },\n        },\n        {\n          search: \"\u5D29\u574F\",\n          patch(json: any) {\n            removeSoundDefs(json);\n            if (json.name === \"\") delete json.name;\n          },\n        },\n        {\n          search: \"\u6218\u8230\u5C11\u5973\",\n          patch(json: any) {\n            removeSoundDefs(json);\n          },\n        },\n        {\n          search: \"\u673A\u52A8\u6218\u961F\",\n          patch(json: any) {\n            removeSoundDefs(json);\n          },\n        },\n        {\n          search: \"\u8BFA\u4E9A\u5E7B\u60F3\",\n          patch(json: any) {\n            if (json.name === \"model\") delete json.name;\n          },\n        },\n      ];\n\n      function folderName(url: string) {\n        try {\n          const u = new URL(url);\n          const parts = u.pathname.split(\"/\").filter(Boolean);\n          return parts.slice(-2, -1)[0] || \"\";\n        } catch {\n          return \"\";\n        }\n      }\n\n      function replaceJSONText(jsonText: string, url: string) {\n        for (const p of patches)\n          if (url.includes(encodeURI(p.search)) && p.replace)\n            jsonText = p.replace(jsonText, url);\n        return jsonText;\n      }\n      async function patchJSON(json: any, url: string) {\n        for (const p of patches)\n          if (url.includes(encodeURI(p.search)) && p.patch)\n            await p.patch(json, url);\n      }\n      async function patchInternalModel(internalModel: any) {\n        const url: string = internalModel?.settings?.url || \"\";\n        for (const p of patches)\n          if (url.includes(encodeURI(p.search)) && p.patchInternalModel)\n            await p.patchInternalModel(internalModel);\n      }\n\n      // tolerant JSON parse: try JSON.parse; attempt simple comma fix fallback\n      function tolerantParse(text: string) {\n        try {\n          return JSON.parse(text);\n        } catch {}\n        try {\n          const fixed = text\n            .replace(/\\r\\n/g, \"\\n\")\n            .replace(/,\\s*(\\}|\\])/g, \"$1\");\n          return JSON.parse(fixed);\n        } catch {}\n        return JSON.parse(text); // let it throw\n      }\n\n      // Replace urlToJSON\n      try {\n        const orig = Live2DFactory.urlToJSON;\n        const arr =\n          Live2DFactory.live2DModelMiddlewares ||\n          Live2DFactory.middlewares ||\n          [];\n        const idxU = arr.indexOf(orig);\n        const urlToJSON = async (context: any, next: any) => {\n          if (typeof context.source === \"string\") {\n            const url: string = context.source;\n            let json: any;\n            if (/\\.(moc|moc3)(\\?|$)/i.test(url)) {\n              // synth settings from moc path minimal\n              const isV3 = /\\.moc3(\\?|$)/i.test(url);\n              const base = url.replace(/[^/]+$/, \"\");\n              if (isV3) {\n                json = {\n                  url: urlUtils.resolve(url, \"dummy.model3.json\"),\n                  FileReferences: { Moc: url, Textures: [], Motions: {} },\n                };\n              } else {\n                json = {\n                  url: urlUtils.resolve(url, \"dummy.model.json\"),\n                  model: url,\n                  textures: [],\n                  motions: {},\n                };\n              }\n            } else {\n              let text = await fetch(url).then((r) => r.text());\n              text = replaceJSONText(text, url);\n              json = tolerantParse(text);\n              json.url = url;\n            }\n            await patchJSON(json, url);\n            setSingleMotionAsIdle(json);\n            context.source = json;\n            try {\n              context.live2dModel &&\n                context.live2dModel.emit &&\n                context.live2dModel.emit(\"settingsJSONLoaded\", json);\n            } catch {}\n          }\n          return next();\n        };\n        if (idxU >= 0) arr[idxU] = urlToJSON;\n        else Live2DFactory.urlToJSON = urlToJSON;\n      } catch {}\n\n      // Patch InternalModel.init\n      try {\n        const origInit = InternalModel.prototype.init;\n        InternalModel.prototype.init = async function patchedInit() {\n          try {\n            await patchInternalModel(this);\n          } catch {}\n          return origInit.apply(this, arguments as any);\n        };\n      } catch {}\n\n      // helpers used by patches\n      function setSingleMotionAsIdle(json: any) {\n        const motions =\n          json && json.FileReferences && json.FileReferences.Motions;\n        if (\n          motions &&\n          !(motions.Idle || [])[0] &&\n          Array.isArray(motions[\"\"]) &&\n          motions[\"\"].length === 1\n        ) {\n          motions.Idle = motions[\"\"].map((m: any) => ({ ...m }));\n        }\n      }\n      function extractCubism2IdleMotions(json: any, keywords: string[]) {\n        if (json && json.motions) {\n          const idle: any[] = [];\n          for (const [group, motions] of Object.entries(json.motions as any)) {\n            if (group !== \"idle\" && Array.isArray(motions)) {\n              for (const motion of motions as any[])\n                for (const kw of keywords)\n                  if (\n                    motion.file &&\n                    String(motion.file).toLowerCase().includes(kw)\n                  )\n                    idle.push(motion);\n            }\n          }\n          if (idle.length)\n            json.motions.idle = unionBy(json.motions.idle, idle, \"file\");\n        }\n      }\n      function extractCubism4IdleMotions(json: any, keywords: string[]) {\n        const ref = json && json.FileReferences && json.FileReferences.Motions;\n        if (ref) {\n          const idle: any[] = [];\n          for (const [group, motions] of Object.entries(ref as any)) {\n            if (group !== \"Idle\" && Array.isArray(motions)) {\n              for (const motion of motions as any[])\n                for (const kw of keywords)\n                  if (\n                    motion.File &&\n                    String(motion.File).toLowerCase().includes(kw)\n                  )\n                    idle.push(motion);\n            }\n          }\n          if (idle.length) ref.Idle = unionBy(ref.Idle, idle, \"File\");\n        }\n      }\n      function removeSoundDefs(json: any) {\n        if (json && json.motions) {\n          for (const grp of Object.values(json.motions as any))\n            if (Array.isArray(grp))\n              for (const m of grp as any[]) m.sound = undefined;\n        }\n      }\n    }\n\n    async function loadSelectedModel(url) {\n      // remove old\n      if (model) {\n        try {\n          app.stage.removeChild(model);\n          model.destroy(true);\n        } catch (e) {}\n        if (lipSyncEnabled) stopLipSync();\n      }\n      // reset motions UI and load via viewer-style helper\n      motionEntries = [];\n      refreshAnimationsUI();\n      const byExt = detectRuntimeByUrl(url);\n      const res = await loadModel(app, url, byExt);\n      model = res && (res as any).model ? (res as any).model : null;\n      availableGroups = Array.isArray((res as any)?.groups)\n        ? (res as any).groups\n        : [];\n      scheduleGroupRefresh();\n      // wait two frames for layout before measuring\n      await new Promise((r) =>\n        requestAnimationFrame(() => requestAnimationFrame(r))\n      );\n      // restore old positioning timing: fit and reveal after layout settles\n      try {\n        fitModelToCanvas();\n        if (model) {\n          (model as any).alpha = 1;\n          (model as any).visible = true;\n        }\n      } catch {}\n      // start Idle loop depending on runtime\n      try {\n        if (currentRuntime === \"c4\") {\n          startIdleLoopC4(model);\n        } else {\n          startIdleLoop(\n            model,\n            Array.from(\n              new Set(\n                (motionEntries || []).map((e) => String(e.group || \"\").trim())\n              )\n            ).filter(Boolean)\n          );\n        }\n      } catch {}\n    }\n\n    // Load model from query if provided, otherwise from saved last model\n    const urlParams = new URLSearchParams(window.location.search);\n    const qpModel = urlParams.get(\"model\");\n    if (qpModel) {\n      await loadSelectedModel(qpModel);\n      if (!Array.from(select.options).some((o) => o.value === qpModel)) {\n        const opt = document.createElement(\"option\");\n        opt.style.display = \"none\";\n        opt.value = qpModel;\n        opt.textContent = \"Selected\";\n        select.appendChild(opt);\n      }\n      select.value = qpModel;\n      try {\n        localStorage.setItem(LAST_MODEL_KEY, qpModel);\n      } catch (e) {}\n    } else {\n      let saved = null;\n      try {\n        saved = localStorage.getItem(LAST_MODEL_KEY) || null;\n      } catch (e) {\n        saved = null;\n      }\n      const initial = saved && /\\.json($|\\?)/i.test(saved) ? saved : MODELS[0];\n      await loadSelectedModel(initial);\n      if (saved && !Array.from(select.options).some((o) => o.value === saved)) {\n        const opt = document.createElement(\"option\");\n        opt.value = saved;\n        opt.textContent = \"Saved\";\n        select.appendChild(opt);\n      }\n      select.value = initial;\n      select.style.display = \"none\";\n    }\n    select.addEventListener(\"change\", () => {\n      const url = select.value;\n      try {\n        localStorage.setItem(LAST_MODEL_KEY, url);\n      } catch (e) {}\n      loadSelectedModel(url);\n    });\n\n    // Inspector logic (GitHub API directory browser)\n    const modal = document.getElementById(\"modelInspector\");\n    const listEl = document.getElementById(\"inspectorList\");\n    const breadcrumbEl = document.getElementById(\"inspectorBreadcrumb\");\n    const urlInput = document.getElementById(\"inspectorUrl\");\n    const loadUrlBtn = document.getElementById(\"inspectorLoadUrl\");\n\n    let currentPath = \"\"; // path within repo\n    let selectedModelPath = \"\"; // repo path to selected .model3.json\n\n    function encodeRepoPath(path) {\n      return (path || \"\")\n        .split(\"/\")\n        .map((seg) => encodeURIComponent(seg))\n        .join(\"/\");\n    }\n    function pathToJsDelivr(repoPath, ref) {\n      const encoded = encodeRepoPath(repoPath);\n      const suffix = ref ? \"@\" + ref : \"\";\n      return (\n        \"https://cdn.jsdelivr.net/gh/Eikanya/Live2d-model\" +\n        suffix +\n        \"/\" +\n        encoded\n      );\n    }\n    function pathToRaw(repoPath, ref) {\n      const encoded = encodeRepoPath(repoPath);\n      const branch = ref || \"master\";\n      return (\n        \"https://raw.githubusercontent.com/Eikanya/Live2d-model/\" +\n        branch +\n        \"/\" +\n        encoded\n      );\n    }\n    async function resolveModelUrl(repoPath) {\n      const tries = [\n        pathToJsDelivr(repoPath, \"master\"),\n        pathToJsDelivr(repoPath, \"v1.0.0\"),\n        pathToRaw(repoPath, \"master\"),\n        pathToRaw(repoPath, \"v1.0.0\"),\n      ];\n      for (const url of tries) {\n        try {\n          const r = await fetch(url, { method: \"HEAD\" });\n          if (r.ok) return url;\n        } catch {}\n      }\n      // fallback to raw master without HEAD check\n      return pathToRaw(repoPath, \"master\");\n    }\n\n    // Prebuilt models index to avoid GitHub API limits\n    const INDEX_URL =\n      \"https://guansss.github.io/live2d-viewer-web/eikanyalive2d-model.json\";\n    let modelIndexRoot = null;\n    let modelInfoMap = null;\n    let indexPathMap = {};\n    async function ensureIndexLoaded() {\n      if (modelIndexRoot && modelInfoMap) return;\n      const resp = await fetch(INDEX_URL);\n      if (!resp.ok) throw new Error(\"Failed to load model index\");\n      const data = await resp.json();\n      modelIndexRoot = data.models;\n      modelInfoMap = {};\n      for (const k of Object.keys(data)) {\n        if (k !== \"models\") modelInfoMap[k] = data[k];\n      }\n      // build path map for robust lookup\n      indexPathMap = {};\n      (function build(node, prefix) {\n        const path = prefix || \"\";\n        indexPathMap[path] = node;\n        const children = (node && node.children) || [];\n        for (const ch of children) {\n          if (!ch || !ch.name) continue;\n          const next = path ? path + \"/\" + ch.name : ch.name;\n          build(ch, next);\n        }\n      })(modelIndexRoot, \"\");\n    }\n    function indexRootName() {\n      return (modelIndexRoot && modelIndexRoot.name) || \"Eikanya/Live2d-model\";\n    }\n    function findIndexNode(path) {\n      return indexPathMap[path || \"\"] || null;\n    }\n    function listDirFromIndex(path) {\n      const node = findIndexNode(path);\n      return {\n        dirs: (node && node.children) || [],\n        files: (node && node.files) || [],\n      };\n    }\n    function buildRepoPath(path, name) {\n      return (path ? path + \"/\" : \"\") + name;\n    }\n    async function buildSyntheticCubism2Json(repoPathToMoc) {\n      const key = indexRootName() + \"/\" + repoPathToMoc;\n      const meta = modelInfoMap[key] || {};\n      const dir = repoPathToMoc.replace(/\\/?[^/]*$/, \"\");\n      const modelUrl = await resolveModelUrl(repoPathToMoc);\n      const textures = Array.isArray(meta.textures)\n        ? meta.textures\n        : [\"texture_00.png\"];\n      const motionsObj = {};\n      if (meta.motions) {\n        for (const g of Object.keys(meta.motions)) {\n          motionsObj[g] = (meta.motions[g] || []).map((m) => ({\n            file: m,\n          }));\n        }\n      }\n      const absTextures = [];\n      for (const t of textures)\n        absTextures.push(await resolveModelUrl((dir ? dir + \"/\" : \"\") + t));\n      const absPhysics = meta.physics\n        ? await resolveModelUrl((dir ? dir + \"/\" : \"\") + meta.physics)\n        : undefined;\n      const json = { model: modelUrl, textures: absTextures };\n      if (absPhysics) json.physics = absPhysics;\n      if (Object.keys(motionsObj).length) json.motions = motionsObj;\n      return (\n        \"data:application/json;charset=utf-8,\" +\n        encodeURIComponent(JSON.stringify(json))\n      );\n    }\n\n    function renderBreadcrumb(path) {\n      const parts = path ? path.split(\"/\") : [];\n      const frag = document.createDocumentFragment();\n      const rootLink = document.createElement(\"a\");\n      rootLink.href = \"#\";\n      rootLink.textContent = \"root\";\n      rootLink.style.color = \"#9cdcfe\";\n      rootLink.addEventListener(\"click\", (e) => {\n        e.preventDefault();\n        loadDir(\"\");\n      });\n      frag.appendChild(rootLink);\n      let acc = \"\";\n      parts.forEach((p, idx) => {\n        const sep = document.createElement(\"span\");\n        sep.textContent = \" / \";\n        frag.appendChild(sep);\n        acc = acc ? acc + \"/\" + p : p;\n        const a = document.createElement(\"a\");\n        a.href = \"#\";\n        a.textContent = p;\n        a.style.color = \"#9cdcfe\";\n        a.addEventListener(\"click\", (e) => {\n          e.preventDefault();\n          loadDir(acc);\n        });\n        frag.appendChild(a);\n      });\n      breadcrumbEl.innerHTML = \"\";\n      breadcrumbEl.appendChild(frag);\n    }\n\n    function getAuthHeaders() {\n      try {\n        const t = localStorage.getItem(\"gh_token\") || \"\";\n        if (t) return { Authorization: `token ${t}` };\n      } catch {}\n      return {};\n    }\n\n    // Expose model for controls\n    window.__live2d_model = model;\n\n    // Pomodoro + RPG logic\n    (function () {\n      const TIMER_WORK_DEFAULT = 25 * 60; // seconds\n      const TIMER_BREAK_DEFAULT = 5 * 60;\n      let workDuration = TIMER_WORK_DEFAULT;\n      let breakDuration = TIMER_BREAK_DEFAULT;\n      let timeLeft = workDuration;\n      let running = false;\n      let mode = \"work\"; // 'work' or 'break'\n\n      // RPG stats\n      const stateKey = \"anime_overlay_rpg_v1\";\n      let state = { level: 1, xp: 0, tomatoes: 0 };\n      try {\n        const saved = localStorage.getItem(stateKey);\n        if (saved) state = JSON.parse(saved);\n      } catch (e) {}\n\n      const $ = (id) => document.getElementById(id);\n      // UI toggle helpers\n      const controlsWrap = $(\"controls\");\n      const toggleUIBtn = $(\"toggleUI\");\n      const showUIBtn = $(\"showUIBtn\");\n      const UI_HIDDEN_KEY = \"anime_overlay_ui_hidden_v1\";\n      function setUIHidden(hidden) {\n        try {\n          if (!controlsWrap || !showUIBtn) return;\n          if (hidden) {\n            controlsWrap.classList.add(\"hidden\");\n            showUIBtn.classList.remove(\"hidden\");\n            localStorage.setItem(UI_HIDDEN_KEY, \"1\");\n          } else {\n            controlsWrap.classList.remove(\"hidden\");\n            showUIBtn.classList.add(\"hidden\");\n            localStorage.setItem(UI_HIDDEN_KEY, \"0\");\n          }\n        } catch {}\n      }\n      try {\n        const saved = localStorage.getItem(UI_HIDDEN_KEY) || \"0\";\n        setUIHidden(saved === \"1\");\n      } catch {}\n      try {\n        if (toggleUIBtn)\n          toggleUIBtn.addEventListener(\"click\", () => {\n            const hidden =\n              controlsWrap && controlsWrap.classList.contains(\"hidden\");\n            setUIHidden(!hidden);\n          });\n        if (showUIBtn)\n          showUIBtn.addEventListener(\"click\", () => setUIHidden(false));\n      } catch {}\n      const timerDisplay = $(\"timerDisplay\");\n      const timerLabel = $(\"timerLabel\");\n      const startBtn = $(\"startBtn\");\n      const pauseBtn = $(\"pauseBtn\");\n      const resetBtn = $(\"resetBtn\");\n      const levelEl = $(\"level\");\n      const xpEl = $(\"xp\");\n      const tomatoesEl = $(\"tomatoes\");\n\n      function saveState() {\n        try {\n          localStorage.setItem(stateKey, JSON.stringify(state));\n        } catch (e) {}\n      }\n      function formatTime(s) {\n        const mm = Math.floor(s / 60);\n        const ss = s % 60;\n        return String(mm).padStart(2, \"0\") + \":\" + String(ss).padStart(2, \"0\");\n      }\n      function updateUI() {\n        timerDisplay.textContent = formatTime(timeLeft);\n        timerLabel.textContent = mode === \"work\" ? \"\u0420\u0430\u0431\u043E\u0442\u0430\" : \"\u041F\u0435\u0440\u0435\u0440\u044B\u0432\";\n        levelEl.textContent = state.level;\n        xpEl.textContent = state.xp;\n        tomatoesEl.textContent = state.tomatoes;\n      }\n\n      function rewardForWork() {\n        state.xp += 10;\n        state.tomatoes += 1;\n        if (state.xp >= state.level * 100) {\n          state.xp -= state.level * 100;\n          state.level += 1; // level up\n          // celebration animation\n          pulseModel(1.3, 600);\n          toast(\"\u0423\u0440\u043E\u0432\u0435\u043D\u044C \u043F\u043E\u0432\u044B\u0448\u0435\u043D!\");\n          speakCategory(\"xp\");\n        } else {\n          pulseModel(1.1, 400);\n        }\n        saveState();\n        updateUI();\n      }\n\n      function toast(msg) {\n        const t = document.createElement(\"div\");\n        t.textContent = msg;\n        t.style.position = \"absolute\";\n        t.style.left = \"8px\";\n        t.style.bottom = \"8px\";\n        t.style.background = \"rgba(0,0,0,0.6)\";\n        t.style.color = \"white\";\n        t.style.padding = \"6px\";\n        t.style.borderRadius = \"6px\";\n        t.style.zIndex = \"30\";\n        document.body.appendChild(t);\n        setTimeout(() => t.remove(), 2500);\n      }\n\n      function pulseModel(scale, to) {\n        const m = window.__live2d_model;\n        if (!m) return;\n        const start = m.scale.x;\n        const target = scale;\n        const dur = to || 400;\n        const origX = m.x;\n        const origY = m.y;\n        const t0 = Date.now();\n        const tick = () => {\n          const p = Math.min(1, (Date.now() - t0) / dur);\n          const val = start + (target - start) * Math.sin(p * Math.PI);\n          m.scale.set(val);\n          // restore position to avoid shift when scaling\n          m.x = origX;\n          m.y = origY;\n          if (p < 1) requestAnimationFrame(tick);\n          else m.scale.set(start);\n        };\n        requestAnimationFrame(tick);\n      }\n\n      function tryStartRandomMotion(preferredGroup) {\n        const m = window.__live2d_model;\n        if (!m) return false;\n        try {\n          // Try common APIs from different Live2D wrappers\n          const groups = [\n            preferredGroup,\n            \"TapBody\",\n            \"TapHand\",\n            \"TapHead\",\n            \"Idle\",\n          ];\n          // 1) PIXI-live2d-display exposes model.motion(name) in some versions\n          if (typeof m.motion === \"function\") {\n            for (const g of groups) {\n              try {\n                if (g) {\n                  m.motion(g);\n                  return true;\n                }\n              } catch (e) {}\n            }\n          }\n          // 2) internalModel.motionManager.startRandomMotion(group)\n          if (m.internalModel && m.internalModel.motionManager) {\n            const manager = m.internalModel.motionManager;\n            if (typeof manager.startRandomMotion === \"function\") {\n              for (const g of groups) {\n                try {\n                  if (g) {\n                    manager.startRandomMotion(g);\n                    toast(\"\u0410\u043D\u0438\u043C\u0430\u0446\u0438\u044F: \" + g); // Added debug toast\n                    return true;\n                  } else {\n                    manager.startRandomMotion();\n                    toast(\"\u0410\u043D\u0438\u043C\u0430\u0446\u0438\u044F: default\"); // Added debug toast\n                    return true;\n                  }\n                } catch (e) {}\n              }\n            }\n            // 3) startMotion (group, index) fallback\n            if (typeof manager.startMotion === \"function\") {\n              for (const g of groups) {\n                try {\n                  manager.startMotion(g || \"\");\n                  return true;\n                } catch (e) {}\n              }\n            }\n          }\n          // 4) model.internalModel.startRandomMotion (other wrappers)\n          if (\n            m.internalModel &&\n            typeof m.internalModel.startRandomMotion === \"function\"\n          ) {\n            try {\n              m.internalModel.startRandomMotion(preferredGroup);\n              return true;\n            } catch (e) {}\n          }\n\n          // fallback gentle pulse\n          pulseModel(1.08, 300);\n          return true;\n        } catch (e) {\n          console.error(\"tryStartRandomMotion failed\", e);\n          pulseModel(1.05, 250);\n          return false;\n        }\n      }\n\n      function playRandomNonIdle() {\n        if (!window.__live2d_model || !motionEntries.length) return;\n        const candidates = motionEntries.filter((m) => {\n          const g = String(m.group || \"\").toLowerCase();\n          const f = String(m.file || \"\").toLowerCase();\n          return g !== \"idle\" && !f.includes(\"idle\");\n        });\n        const list = candidates.length ? candidates : motionEntries;\n        const pick = list[Math.floor(Math.random() * list.length)];\n        try {\n          const mm =\n            window.__live2d_model.internalModel &&\n            window.__live2d_model.internalModel.motionManager;\n          const pr = getForcePriority();\n          if (mm && typeof mm.startMotion === \"function\")\n            mm.startMotion(pick.group, pick.index, pr);\n          else if (mm && typeof mm.startRandomMotion === \"function\")\n            mm.startRandomMotion(pick.group, pr);\n        } catch (e) {}\n      }\n\n      function interruptAndPlayRandomNonIdle() {\n        const m = window.__live2d_model;\n        if (!m) return;\n\n        const tryRuntimeGroups = () => {\n          try {\n            const mmFallback =\n              m && m.internalModel && m.internalModel.motionManager;\n            const defs =\n              mmFallback &&\n              (mmFallback.definitions ||\n                mmFallback._definitions ||\n                mmFallback._motions);\n            if (defs && Object.keys(defs).length) {\n              const groups = Object.keys(defs).filter(\n                (g) =>\n                  String(g || \"\").toLowerCase() !== \"idle\" &&\n                  String(g || \"\").length > 0\n              );\n              if (groups.length) {\n                const g = groups[Math.floor(Math.random() * groups.length)];\n                const pr = getForcePriority();\n                if (typeof mmFallback.startRandomMotion === \"function\") {\n                  mmFallback.startRandomMotion(g, pr);\n                  return true;\n                }\n                if (typeof mmFallback.startMotion === \"function\") {\n                  mmFallback.startMotion(g, 0, pr);\n                  return true;\n                }\n              }\n            }\n          } catch (e) {}\n          return false;\n        };\n\n        const stopCurrent = () => {\n          try {\n            const mm = m.internalModel && m.internalModel.motionManager;\n            if (mm) {\n              if (typeof mm.stopAllMotions === \"function\") mm.stopAllMotions();\n              else if (\n                mm._motionQueueManager &&\n                typeof mm._motionQueueManager.stopAllMotions === \"function\"\n              )\n                mm._motionQueueManager.stopAllMotions();\n            }\n          } catch (e) {}\n        };\n\n        const tryModelConvenience = () => {\n          try {\n            if (typeof m.motion === \"function\") {\n              const groups = [\"TapBody\", \"TapHead\", \"Tap\", \"Body\", \"Idle\"];\n              for (const g of groups) {\n                try {\n                  m.motion(g);\n                  return true;\n                } catch (e) {}\n              }\n            }\n          } catch (e) {}\n          return false;\n        };\n\n        let attempts = 5;\n        const tryStart = () => {\n          // stop whatever is running\n          stopCurrent();\n          // 1) use parsed entries\n          if (Array.isArray(motionEntries) && motionEntries.length) {\n            playRandomNonIdle();\n            snoozeIdle(m, 6000);\n            return;\n          }\n          // 2) use runtime groups\n          if (tryRuntimeGroups()) {\n            snoozeIdle(m, 6000);\n            return;\n          }\n          // 3) last resort: try generic triggers via helper\n          try {\n            if (typeof tryStartRandomMotion === \"function\") {\n              const ok = tryStartRandomMotion(\"TapBody\");\n              if (ok) {\n                snoozeIdle(m, 6000);\n                return;\n              }\n            }\n          } catch (e) {}\n          // 4) model.motion convenience if available\n          if (tryModelConvenience()) {\n            snoozeIdle(m, 6000);\n            return;\n          }\n          if (attempts-- > 0) setTimeout(tryStart, 200);\n        };\n        tryStart();\n      }\n\n      function focusModel() {\n        const m = window.__live2d_model;\n        if (!m) return;\n        m.scale.set(0.55);\n      }\n      function relaxModel() {\n        const m = window.__live2d_model;\n        if (!m) return;\n        m.scale.set(0.65);\n      }\n\n      let timerInterval = null;\n      function startTimer() {\n        if (running) return;\n        running = true;\n        startBtn.disabled = true;\n        pauseBtn.disabled = false;\n        // no model zoom on timer start\n        speakCategory(\"start\");\n        // ensure animation triggers even if audio is blocked\n        interruptAndPlayRandomNonIdle();\n        timerInterval = setInterval(() => {\n          timeLeft--;\n          if (timeLeft <= 0) {\n            clearInterval(timerInterval);\n            running = false;\n            startBtn.disabled = false;\n            pauseBtn.disabled = true;\n            completeSession();\n          }\n          updateUI();\n        }, 1000);\n      }\n      function pauseTimer() {\n        if (!running) return;\n        running = false;\n        clearInterval(timerInterval);\n        startBtn.disabled = false;\n        pauseBtn.disabled = true;\n        speakCategory(\"break\");\n        interruptAndPlayRandomNonIdle();\n      }\n      function resetTimer() {\n        pauseTimer();\n        mode = \"work\";\n        workDuration = TIMER_WORK_DEFAULT;\n        breakDuration = TIMER_BREAK_DEFAULT;\n        timeLeft = workDuration;\n        updateUI();\n      }\n\n      function completeSession() {\n        if (mode === \"work\") {\n          rewardForWork();\n          mode = \"break\";\n          timeLeft = breakDuration;\n          toast(\"\u041F\u0435\u0440\u0435\u0440\u044B\u0432!\"); // model reaction\n          speakCategory(\"break\");\n          try {\n            const m = window.__live2d_model;\n            if (\n              m &&\n              m.internalModel &&\n              m.internalModel.motionManager &&\n              m.internalModel.motionManager.startRandomMotion\n            )\n              m.internalModel.motionManager.startRandomMotion(\"Relax\");\n          } catch (e) {}\n        } else {\n          mode = \"work\";\n          timeLeft = workDuration;\n          toast(\"\u0412\u0440\u0435\u043C\u044F \u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C!\");\n          speakCategory(\"finish\");\n        }\n        updateUI();\n      }\n\n      // clicks on model grant small XP\n      const modelDiv = $(\"model\");\n      modelDiv.addEventListener(\"click\", () => {\n        state.xp += 1;\n        saveState();\n        updateUI();\n        toast(\"+1 XP\");\n      });\n\n      startBtn.addEventListener(\"click\", startTimer);\n      pauseBtn.addEventListener(\"click\", pauseTimer);\n      resetBtn.addEventListener(\"click\", resetTimer);\n\n      // initialize UI\n      timeLeft = workDuration;\n      updateUI();\n      pauseBtn.disabled = true;\n      startBtn.disabled = false;\n      // subscribe to extension events (deduped)\n      if (window.overlayAPI && window.overlayAPI.onEvent) {\n        const processed = new Set();\n        window.overlayAPI.onEvent((data) => {\n          try {\n            if (!data || !data.type) return;\n            const key = [data.type, data.path || \"\", data.timestamp || \"\"].join(\n              \"|\"\n            );\n            if (processed.has(key)) return;\n            processed.add(key);\n\n            if (data.type === \"save\") {\n              const chars = typeof data.chars === \"number\" ? data.chars : 0;\n              let gain = 0;\n              if (chars > 0) gain = Math.max(1, Math.ceil(chars / 10));\n              if (gain > 0) {\n                state.xp += gain;\n                saveState();\n                updateUI();\n                toast(\"\u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043E: +\" + gain + \" XP (\" + chars + \" chars)\");\n                speakCategory(\"xp\");\n                playRandomNonIdle();\n              } else {\n                // no XP for zero-chars save\n                toast(\"\u0421\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u043E (\u0431\u0435\u0437 XP)\");\n              }\n            } else if (data.type === \"edit\") {\n              // edits don't grant XP until saved; just react\n              saveState();\n              updateUI();\n              toast(\"\u041F\u0440\u0430\u0432\u043A\u0430\");\n              playRandomNonIdle();\n              if (Math.random() < 0.1) speakCategory(\"fun\");\n            } else if (data.type === \"focus\") {\n              focusModel();\n              toast(\"\u0424\u043E\u043A\u0443\u0441 \u043D\u0430 \u0444\u0430\u0439\u043B\u0435\");\n            }\n          } catch (e) {\n            console.error(\"onEvent handler\", e);\n          }\n        });\n      }\n    })();\n  } catch (e) {\n    console.error(\"Live2D load error\", e);\n    const el = document.getElementById(\"model\");\n    el.textContent =\n      \"\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u043C\u043E\u0434\u0435\u043B\u0438: \" + (e && e.message ? e.message : e);\n    // \u043F\u043E\u043F\u044B\u0442\u0430\u0442\u044C\u0441\u044F \u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C fallback \u0438\u0437 \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u044B\u0445 \u0430\u0441\u0441\u0435\u0442\u043E\u0432\n    const img = document.createElement(\"img\");\n    img.style.width = \"100%\";\n    img.style.height = \"100%\";\n    img.src = \"../cowsay.gif\";\n    el.appendChild(img);\n  }\n})();\n// controls\nconst pinBtn = document.getElementById(\"pin\");\nconst opacityInput = document.getElementById(\"opacity\");\nlet pinned = false;\npinBtn.addEventListener(\"click\", async () => {\n  pinned = !pinned;\n  pinBtn.textContent = pinned ? \"Pinned\" : \"Pin\";\n  if (window.overlayAPI) await window.overlayAPI.toggleClickThrough(pinned);\n});\n\nopacityInput.addEventListener(\"input\", () => {\n  try {\n    const m = (window as any).__live2d_model;\n    const base = (window as any).__live2d_base_scale || (m ? m.scale.x : 1);\n    const factor = Math.max(\n      0.5,\n      Math.min(1.5, Number((opacityInput as HTMLInputElement).value) || 1)\n    );\n    if (m && isFinite(base)) {\n      const origX = m.x;\n      const origY = m.y;\n      m.scale.set(base * factor);\n      m.x = origX;\n      m.y = origY;\n    }\n  } catch {}\n});\n// \u043E\u0442\u043A\u0440\u044B\u0442\u044C devtools \u043F\u043E F12\nwindow.addEventListener(\"keydown\", (e) => {\n  if (e.key === \"F12\" && window.overlayAPI && window.overlayAPI.openDevTools)\n    window.overlayAPI.openDevTools();\n});\n"],
  "mappings": "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",
  "names": ["installStageDragHandlers", "enableDraggingForModel", "fitModelToCanvas", "resizeStageToContainer", "makeAbsolute", "buildCubism2DataJson", "detectUseV4FromUrl", "detectRuntimeByUrl", "toAbsoluteAssetUrl", "rewriteModelJsonUrls", "clearPixiCaches", "urlToRepoPath", "setMouthOpenParam", "sayRandom", "getAudio", "playAudioCategory", "getForcePriority", "ensureAudioContext", "startLipSyncForAudio", "startLipSyncForSpeech", "playRandomNonIdle", "interruptAndPlayRandomNonIdle", "snoozeIdle", "speakCategory", "stopLipSync", "refreshAnimationsUI", "getGroupsFromManager", "scheduleGroupRefresh", "playSelectedAnimationGroup", "getMotionEntriesFromJson", "startIdleLoop", "model", "startIdleLoopC4", "applyPixiLive2dPatches", "encodeRepoPath", "pathToJsDelivr", "pathToRaw", "indexRootName", "findIndexNode", "listDirFromIndex", "buildRepoPath", "renderBreadcrumb", "getAuthHeaders"]
}
